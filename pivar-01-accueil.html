<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIVAR - Accueil S√©curis√©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* BLOCAGE ABSOLU DE LA S√âLECTION */
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
            -webkit-tap-highlight-color: transparent !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            /* PROTECTIONS CSS MAXIMALES */
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
            -khtml-user-select: none !important;
            -webkit-user-drag: none !important;
            -khtml-user-drag: none !important;
            -moz-user-drag: none !important;
            -o-user-drag: none !important;
            user-drag: none !important;
        }

        /* BLOCAGE ABSOLU DE TOUTE S√âLECTION */
        *::selection {
            background: transparent !important;
        }
        *::-moz-selection {
            background: transparent !important;
        }
        *::-webkit-selection {
            background: transparent !important;
        }

        .header-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .header-banner h1 {
            font-size: 20px;
            margin: 0;
        }

        .progress-bar {
            background: #28a745;
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: calc(100vh - 100px);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .security-notice {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 0;
            font-size: 13px;
            color: #155724;
            text-align: center;
        }

        .questionnaire-frame {
            width: 100%;
            height: calc(100vh - 160px);
            border: none;
            display: block;
            /* EMP√äCHER TOUTE INTERACTION DIRECTE AVEC L'IFRAME */
            pointer-events: none;
        }

        /* COUCHE DE PROTECTION INVISIBLE AU-DESSUS DE L'IFRAME */
        .iframe-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100vh - 160px);
            z-index: 10;
            background: transparent;
            pointer-events: auto;
        }

        .footer {
            background: #f8f9fa;
            text-align: center;
            padding: 10px;
            font-size: 12px;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }

        /* OVERLAY D'ALERTE RENFORC√â */
        .security-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(220, 53, 69, 0.98) !important;
            color: white;
            display: none;
            z-index: 999999;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        .security-content {
            background: #dc3545;
            padding: 40px;
            border-radius: 15px;
            border: 3px solid #fff;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            max-width: 600px;
            animation: shake 0.8s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(1); }
            25% { transform: translateX(-10px) scale(1.02); }
            75% { transform: translateX(10px) scale(1.02); }
        }

        .security-title {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .security-message {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .countdown {
            font-size: 2rem;
            color: #ffeb3b;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* Watermarks multiples */
        .watermark1 {
            position: fixed;
            top: 25%;
            left: 25%;
            transform: rotate(-45deg);
            font-size: 1.2rem;
            color: rgba(220, 53, 69, 0.05);
            z-index: 1;
            pointer-events: none;
            font-weight: bold;
        }

        .watermark2 {
            position: fixed;
            top: 75%;
            right: 25%;
            transform: rotate(45deg);
            font-size: 1.2rem;
            color: rgba(220, 53, 69, 0.05);
            z-index: 1;
            pointer-events: none;
            font-weight: bold;
        }

        /* Styles mobiles */
        @media (max-width: 768px) {
            .header-banner h1 {
                font-size: 16px;
            }
            .progress-bar {
                font-size: 12px;
                padding: 6px;
            }
            .questionnaire-frame {
                height: calc(100vh - 140px);
            }
            .iframe-overlay {
                height: calc(100vh - 140px);
            }
            .security-content {
                padding: 30px 20px;
                margin: 20px;
            }
            .security-title {
                font-size: 2.2rem;
            }
        }

        /* PROTECTION CONTRE F12 ET DEVTOOLS */
        .devtools-detected {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000 !important;
            color: #ff0000;
            z-index: 999999;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Watermarks multiples -->
    <div class="watermark1">SESSION PIVAR PROT√âG√âE</div>
    <div class="watermark2">REPRODUCTION INTERDITE</div>

    <!-- En-t√™te professionnel PIVAR -->
    <div class="header-banner">
        <h1>üß† PIVAR ‚Äì Protocole d'identification et de valorisation de l'action et de la r√©ussite</h1>
        <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">Plateforme s√©curis√©e d'√©valuation comportementale</p>
    </div>

    <!-- Barre de progression -->
    <div class="progress-bar">
        üìä QUESTIONNAIRE 1/7 : ACCUEIL PIVAR ‚Ä¢ Session s√©curis√©e ‚Ä¢ Reproduction interdite - Protection CONTINEW
    </div>

    <!-- Conteneur principal -->
    <div class="main-container">
        <!-- Notice de s√©curit√© -->
        <div class="security-notice">
            ‚úÖ Session s√©curis√©e active ‚Ä¢ Vos donn√©es sont prot√©g√©es ‚Ä¢ √âvaluation confidentielle
        </div>

        <!-- Conteneur de l'iframe avec overlay de protection -->
        <div style="position: relative;">
            <!-- Questionnaire Tally int√©gr√© -->
            <iframe 
                class="questionnaire-frame" 
                src="https://formulaires.pivar.info/r/mJog7Y"
                title="Questionnaire PIVAR S√©curis√©"
                allowtransparency="true"
                sandbox="allow-scripts allow-forms allow-same-origin allow-popups"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
            
            <!-- Couche de protection invisible -->
            <div class="iframe-overlay" id="iframeOverlay"></div>
        </div>

        <!-- Pied de page -->
        <div class="footer">
            PIVAR ¬© 2025 ‚Ä¢ Toute reproduction interdite
        </div>
    </div>

    <!-- OVERLAY D'ALERTE DE S√âCURIT√â -->
    <div id="securityOverlay" class="security-overlay">
        <div class="security-content">
            <div class="security-title">üö® VIOLATION D√âTECT√âE</div>
            <div class="security-message" id="securityMessage">
                ACTION NON AUTORIS√âE
            </div>
            <div class="countdown">
                ‚è±Ô∏è Questionnaire dans <span id="countdown">5</span>s
            </div>
        </div>
    </div>

    <!-- DevTools Detection -->
    <div id="devtoolsAlert" class="devtools-detected">
        üö® OUTILS D√âVELOPPEUR D√âTECT√âS<br>
        FERMER IMM√âDIATEMENT<br>
        SESSION SURVEILL√âE
    </div>

    <script>
        // Configuration ultra-s√©curis√©e
        const ULTRA_SECURITY = {
            sessionId: 'PIVAR_ULTRA_' + Date.now(),
            violations: 0,
            maxViolations: 3, // Plus strict
            alertActive: false,
            lastViolation: 0
        };

        console.log('üõ°Ô∏è PIVAR ULTRA SECURITY - Session:', ULTRA_SECURITY.sessionId);

        // Fonction d'alerte PERSISTANTE
        function showUltraAlert(violationType, details = '') {
            // √âviter le spam d'alertes
            const now = Date.now();
            if (ULTRA_SECURITY.alertActive || (now - ULTRA_SECURITY.lastViolation) < 1000) {
                return;
            }

            ULTRA_SECURITY.alertActive = true;
            ULTRA_SECURITY.lastViolation = now;
            ULTRA_SECURITY.violations++;
            
            const overlay = document.getElementById('securityOverlay');
            const messageElement = document.getElementById('securityMessage');
            
            messageElement.innerHTML = `
                <strong>${violationType}</strong><br>
                ${details}<br><br>
                üö® VIOLATION ${ULTRA_SECURITY.violations}/${ULTRA_SECURITY.maxViolations} üö®<br>
                SESSION ENREGISTR√âE ET TRAC√âE<br>
                <small>ID: ${ULTRA_SECURITY.sessionId}</small>
            `;
            
            overlay.style.display = 'flex';
            
            // Countdown plus long et plus visible
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    overlay.style.display = 'none';
                    ULTRA_SECURITY.alertActive = false;
                    
                    // Fermeture automatique apr√®s 3 violations
                    if (ULTRA_SECURITY.violations >= ULTRA_SECURITY.maxViolations) {
                        alert('TROP DE VIOLATIONS D√âTECT√âES\nSESSION TERMIN√âE AUTOMATIQUEMENT\nContactez l\'administrateur si n√©cessaire.');
                        window.location.href = 'about:blank';
                    }
                }
            }, 1000);
            
            console.log(`üö® ULTRA VIOLATION: ${violationType} - Session: ${ULTRA_SECURITY.sessionId}`);
        }

        // PROTECTION TOTALE - √âV√âNEMENTS MULTIPLES
        function setupUltraProtection() {
            const events = ['contextmenu', 'selectstart', 'dragstart', 'drop', 'copy', 'cut', 'paste'];
            
            events.forEach(eventType => {
                // Protection sur document
                document.addEventListener(eventType, function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    showUltraAlert(`${eventType.toUpperCase()} INTERDIT`, 'Action bloqu√©e par la s√©curit√© PIVAR');
                    return false;
                }, true);
                
                // Protection sur window
                window.addEventListener(eventType, function(e) {
                    e.preventDefault();
                    return false;
                }, true);
                
                // Protection sur body
                if (document.body) {
                    document.body.addEventListener(eventType, function(e) {
                        e.preventDefault();
                        return false;
                    }, true);
                }
            });
        }

        // PROTECTION CLAVIER ULTRA-RENFORC√âE
        function setupKeyboardProtection() {
            document.addEventListener('keydown', function(e) {
                let blocked = false;
                let reason = '';
                
                // LISTE EXHAUSTIVE DES TOUCHES INTERDITES
                const forbiddenKeys = [
                    // Print Screen sous toutes ses formes
                    'PrintScreen', 'Print', 'Snapshot', 'F13',
                    // Touches fonction
                    'F1', 'F2', 'F3', 'F4', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12',
                    // Navigation syst√®me
                    'Insert', 'Delete', 'Home', 'End', 'PageUp', 'PageDown'
                ];
                
                // V√©rification des codes de touches aussi
                const forbiddenCodes = [44, 42, 124, 183, 122, 123]; // Print Screen variants
                
                if (forbiddenKeys.includes(e.key) || forbiddenCodes.includes(e.keyCode)) {
                    blocked = true;
                    reason = `TOUCHE ${e.key || 'SYST√àME'} INTERDITE`;
                }
                // TOUTES combinaisons avec Ctrl
                else if (e.ctrlKey) {
                    blocked = true;
                    reason = `CTRL+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
                }
                // TOUTES combinaisons avec Alt
                else if (e.altKey) {
                    blocked = true;
                    reason = `ALT+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
                }
                // TOUTES combinaisons avec Meta (Windows/Cmd)
                else if (e.metaKey) {
                    blocked = true;
                    reason = `WIN/CMD+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
                }
                // Combinaisons avec Shift (sauf saisie normale)
                else if (e.shiftKey && ['F10', 'Insert', 'Delete'].includes(e.key)) {
                    blocked = true;
                    reason = `SHIFT+${e.key} INTERDIT`;
                }
                
                if (blocked) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    showUltraAlert(reason, 'Combinaison de touches bloqu√©e');
                    return false;
                }
            }, true);
        }

        // PROTECTION SOURIS ULTRA
        function setupMouseProtection() {
            // Tous les √©v√©nements souris
            const mouseEvents = ['mousedown', 'mouseup', 'click', 'dblclick', 'mousemove'];
            
            mouseEvents.forEach(eventType => {
                document.addEventListener(eventType, function(e) {
                    // Bloquer clic droit (bouton 2)
                    if (e.button === 2 || e.which === 3) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        showUltraAlert('CLIC DROIT INTERDIT', 'Menu contextuel d√©sactiv√©');
                        return false;
                    }
                    
                    // Bloquer double-clic pour s√©lection
                    if (eventType === 'dblclick') {
                        e.preventDefault();
                        showUltraAlert('DOUBLE-CLIC INTERDIT', 'S√©lection rapide bloqu√©e');
                        return false;
                    }
                    
                    // Bloquer s√©lection par glissement
                    if (eventType === 'mousedown' && e.button === 0) {
                        // Autoriser uniquement dans l'iframe (approximativement)
                        const iframe = document.querySelector('.questionnaire-frame');
                        const rect = iframe.getBoundingClientRect();
                        const isInIframe = e.clientX >= rect.left && e.clientX <= rect.right && 
                                         e.clientY >= rect.top && e.clientY <= rect.bottom;
                        
                        if (!isInIframe) {
                            e.preventDefault();
                        }
                    }
                }, true);
            });
        }

        // D√âTECTION DEVTOOLS ULTRA-SENSIBLE
        function setupDevToolsDetection() {
            let devToolsOpen = false;
            
            function checkDevTools() {
                const threshold = 100; // Plus sensible
                const heightDiff = window.outerHeight - window.innerHeight;
                const widthDiff = window.outerWidth - window.innerWidth;
                
                if (heightDiff > threshold || widthDiff > threshold) {
                    if (!devToolsOpen) {
                        devToolsOpen = true;
                        document.getElementById('devtoolsAlert').style.display = 'flex';
                        showUltraAlert('OUTILS D√âVELOPPEUR D√âTECT√âS', 'Fermer imm√©diatement F12');
                    }
                } else {
                    if (devToolsOpen) {
                        devToolsOpen = false;
                        document.getElementById('devtoolsAlert').style.display = 'none';
                    }
                }
            }
            
            // V√©rification continue tr√®s fr√©quente
            setInterval(checkDevTools, 200);
        }

        // PROTECTION OVERLAY IFRAME
        function setupIframeProtection() {
            const overlay = document.getElementById('iframeOverlay');
            
            overlay.addEventListener('click', function(e) {
                // Permettre le clic dans l'iframe en retirant temporairement l'overlay
                overlay.style.pointerEvents = 'none';
                
                // Remettre la protection apr√®s 100ms
                setTimeout(() => {
                    overlay.style.pointerEvents = 'auto';
                }, 100);
            });
            
            // Protection contre les tentatives de suppression de l'overlay
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' || mutation.type === 'attributes') {
                        // V√©rifier que l'overlay est toujours l√†
                        if (!document.getElementById('iframeOverlay')) {
                            showUltraAlert('MANIPULATION DOM D√âTECT√âE', 'Tentative de contournement bloqu√©e');
                            location.reload(); // Recharger la page
                        }
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true,
                attributes: true
            });
        }

        // INITIALISATION COMPL√àTE
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisation ULTRA SECURITY...');
            
            setupUltraProtection();
            setupKeyboardProtection();
            setupMouseProtection();
            setupDevToolsDetection();
            setupIframeProtection();
            
            console.log('‚úÖ ULTRA SECURITY ACTIVE');
            
            // Message de bienvenue s√©curis√©
            setTimeout(() => {
                if (!sessionStorage.getItem('pivar-ultra-welcome')) {
                    showUltraAlert('BIENVENUE SUR PIVAR', 'Plateforme ultra-s√©curis√©e - Respectez les consignes');
                    sessionStorage.setItem('pivar-ultra-welcome', 'shown');
                }
            }, 3000);
        });

        // PROTECTIONS SUPPL√âMENTAIRES
        
        // D√©sactiver le cache pour √©viter les contournements
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
        
        // Protection contre la console
        (function() {
            let devtools = {open: false, orientation: null};
            const threshold = 160;
            setInterval(function() {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        showUltraAlert('CONSOLE D√âVELOPPEUR', 'Acc√®s non autoris√© d√©tect√©');
                    }
                } else {
                    devtools.open = false;
                }
            }, 500);
        })();
        
        // Message final pour d√©veloppeurs
        console.log('%cüõ°Ô∏è PIVAR ULTRA SECURITY', 'color: red; font-size: 24px; font-weight: bold;');
        console.log('%cSyst√®me de protection avanc√© actif', 'color: orange; font-size: 16px;');
        console.log('%cToute tentative de contournement est d√©tect√©e et enregistr√©e', 'color: red; font-size: 14px;');
    </script>
</body>
</html>
