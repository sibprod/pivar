<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIVAR - Accueil S√©curis√©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            /* D√©sactiver la s√©lection de base */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Permettre la s√©lection UNIQUEMENT dans l'iframe */
        iframe {
            -webkit-user-select: auto !important;
            -moz-user-select: auto !important;
            -ms-user-select: auto !important;
            user-select: auto !important;
        }

        .header-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .header-banner h1 {
            font-size: 20px;
            margin: 0;
        }

        .progress-bar {
            background: #28a745;
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: calc(100vh - 100px);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .security-notice {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 0;
            font-size: 13px;
            color: #155724;
            text-align: center;
        }

        .questionnaire-frame {
            width: 100%;
            height: calc(100vh - 160px);
            border: none;
            display: block;
            pointer-events: auto;
        }

        .footer {
            background: #f8f9fa;
            text-align: center;
            padding: 10px;
            font-size: 12px;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }

        /* OVERLAY D'ALERTE - Version am√©lior√©e */
        .security-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(220, 53, 69, 0.95);
            color: white;
            display: none;
            z-index: 999999;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        .security-content {
            background: #dc3545;
            padding: 40px;
            border-radius: 15px;
            border: 3px solid #fff;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            max-width: 500px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .security-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffeb3b;
        }

        .security-message {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .countdown {
            font-size: 1.8rem;
            color: #ffeb3b;
            font-weight: bold;
        }

        /* Protection anti-screenshot avec overlay transparent */
        .anti-screenshot {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: transparent;
            z-index: 1;
            pointer-events: none;
        }

        /* Watermark de protection */
        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 1.5rem;
            color: rgba(220, 53, 69, 0.03);
            z-index: 2;
            pointer-events: none;
            font-weight: bold;
            white-space: nowrap;
        }

        /* Styles mobiles */
        @media (max-width: 768px) {
            .header-banner h1 {
                font-size: 16px;
            }
            .progress-bar {
                font-size: 12px;
                padding: 6px;
            }
            .questionnaire-frame {
                height: calc(100vh - 140px);
            }
            .security-content {
                padding: 30px 20px;
                margin: 20px;
            }
            .security-title {
                font-size: 2rem;
            }
        }

        /* Protection DevTools */
        @media screen and (min-width: 0px) {
            .devtools-warning {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #000;
                color: #ff0000;
                z-index: 999999;
                display: none;
                justify-content: center;
                align-items: center;
                font-size: 3rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Watermark de protection -->
    <div class="watermark">
        SESSION PIVAR PROT√âG√âE - REPRODUCTION INTERDITE
    </div>

    <!-- Protection anti-screenshot -->
    <div class="anti-screenshot"></div>

    <!-- En-t√™te professionnel PIVAR -->
    <div class="header-banner">
        <h1>üß† PIVAR ‚Äì Protocole d'identification et de valorisation de l'action et de la r√©ussite</h1>
        <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">Plateforme s√©curis√©e d'√©valuation comportementale</p>
    </div>

    <!-- Barre de progression -->
    <div class="progress-bar">
        üìä QUESTIONNAIRE 1/7 : ACCUEIL PIVAR ‚Ä¢ Session s√©curis√©e ‚Ä¢ Reproduction interdite - Protection CONTINEW
    </div>

    <!-- Conteneur principal -->
    <div class="main-container">
        <!-- Notice de s√©curit√© -->
        <div class="security-notice">
            ‚úÖ Session s√©curis√©e active ‚Ä¢ Vos donn√©es sont prot√©g√©es ‚Ä¢ √âvaluation confidentielle
        </div>

        <!-- Questionnaire Tally int√©gr√© -->
        <iframe 
            class="questionnaire-frame" 
            src="https://formulaires.pivar.info/r/mJog7Y"
            title="Questionnaire PIVAR S√©curis√©"
            allowtransparency="true"
            sandbox="allow-scripts allow-forms allow-same-origin allow-popups"
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>

        <!-- Pied de page -->
        <div class="footer">
            PIVAR ¬© 2025 ‚Ä¢ Toute reproduction interdite
        </div>
    </div>

    <!-- OVERLAY D'ALERTE DE S√âCURIT√â -->
    <div id="securityOverlay" class="security-overlay">
        <div class="security-content">
            <div class="security-title">üö® ALERTE S√âCURIT√â</div>
            <div class="security-message" id="securityMessage">
                ACTION NON AUTORIS√âE D√âTECT√âE
            </div>
            <div class="countdown">
                Reprise dans <span id="countdown">3</span>s
            </div>
        </div>
    </div>

    <!-- DevTools Warning -->
    <div id="devtoolsWarning" class="devtools-warning">
        üö® OUTILS D√âVELOPPEUR D√âTECT√âS<br>
        FERMER IMM√âDIATEMENT
    </div>

    <script>
        // Configuration de s√©curit√©
        const SECURITY_CONFIG = {
            sessionId: 'PIVAR_' + Date.now(),
            violations: 0,
            maxViolations: 5,
            logEnabled: true
        };

        console.log('üõ°Ô∏è PIVAR Security Active - Session:', SECURITY_CONFIG.sessionId);

        // Fonction d'affichage de l'alerte s√©curis√©e
        function showSecurityAlert(violationType, details = '') {
            SECURITY_CONFIG.violations++;
            
            const overlay = document.getElementById('securityOverlay');
            const messageElement = document.getElementById('securityMessage');
            
            messageElement.innerHTML = `
                <strong>${violationType}</strong><br>
                ${details}<br>
                VIOLATION ${SECURITY_CONFIG.violations}/${SECURITY_CONFIG.maxViolations}<br>
                SESSION SURVEILL√âE ET ENREGISTR√âE
            `;
            
            overlay.style.display = 'flex';
            
            // Countdown
            let countdown = 3;
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    overlay.style.display = 'none';
                    
                    // Si trop de violations, redirection
                    if (SECURITY_CONFIG.violations >= SECURITY_CONFIG.maxViolations) {
                        alert('Trop de violations d√©tect√©es. Session termin√©e.');
                        window.location.href = 'about:blank';
                    }
                }
            }, 1000);
            
            // Log de s√©curit√©
            if (SECURITY_CONFIG.logEnabled) {
                console.log(`üö® VIOLATION: ${violationType} - ${details} - Session: ${SECURITY_CONFIG.sessionId}`);
            }
        }

        // PROTECTION CLAVIER RENFORC√âE
        document.addEventListener('keydown', function(e) {
            // Permettre la saisie normale dans l'iframe
            if (e.target.closest('iframe') || e.target.matches('input, textarea, select, [contenteditable]')) {
                return true;
            }
            
            let blocked = false;
            let reason = '';
            
            // Print Screen - Detection multiconfiguration
            if (e.key === 'PrintScreen' || e.code === 'PrintScreen' || 
                e.keyCode === 44 || e.keyCode === 42 || e.keyCode === 124 || 
                (e.keyCode >= 40 && e.keyCode <= 50 && !e.key) ||
                (e.key === 'Unidentified' && e.keyCode > 40)) {
                blocked = true;
                reason = 'CAPTURE D\'√âCRAN INTERDITE';
            }
            // Combinaisons Ctrl
            else if (e.ctrlKey && ['a', 'c', 'v', 'x', 's', 'p', 'u', 'i', 'j'].includes(e.key?.toLowerCase())) {
                blocked = true;
                reason = `CTRL+${e.key.toUpperCase()} INTERDIT`;
            }
            // Touches fonction (sauf F5 pour rafra√Æchir)
            else if (e.key?.startsWith('F') && e.key !== 'F5') {
                blocked = true;
                reason = `TOUCHE ${e.key} INTERDITE`;
            }
            // Combinaisons Alt
            else if (e.altKey && e.key !== 'Tab') {
                blocked = true;
                reason = `ALT+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
            }
            // Combinaisons Windows/Cmd
            else if (e.metaKey) {
                blocked = true;
                reason = `WIN+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
            }
            
            if (blocked) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                showSecurityAlert(reason, 'Action bloqu√©e pour prot√©ger le contenu');
                return false;
            }
        }, true);

        // PROTECTION CLIC DROIT AM√âLIOR√âE
        document.addEventListener('contextmenu', function(e) {
            // Permettre dans l'iframe
            if (e.target.closest('iframe')) {
                return true;
            }
            
            e.preventDefault();
            showSecurityAlert('MENU CONTEXTUEL BLOQU√â', 'Clic droit d√©sactiv√© pour la s√©curit√©');
            return false;
        }, true);

        // PROTECTION S√âLECTION DE TEXTE
        document.addEventListener('selectstart', function(e) {
            // Permettre dans l'iframe et les champs de saisie
            if (e.target.closest('iframe') || e.target.matches('input, textarea, [contenteditable]')) {
                return true;
            }
            
            e.preventDefault();
            return false;
        });

        // PROTECTION GLISSER-D√âPOSER
        document.addEventListener('dragstart', function(e) {
            if (!e.target.closest('iframe')) {
                e.preventDefault();
                showSecurityAlert('GLISSER-D√âPOSER INTERDIT', 'Action bloqu√©e pour la s√©curit√©');
                return false;
            }
        });

        // D√âTECTION DEVTOOLS AM√âLIOR√âE
        let devToolsOpen = false;
        function detectDevTools() {
            const threshold = 160;
            const heightDiff = window.outerHeight - window.innerHeight;
            const widthDiff = window.outerWidth - window.innerWidth;
            
            if (heightDiff > threshold || widthDiff > threshold) {
                if (!devToolsOpen) {
                    devToolsOpen = true;
                    document.getElementById('devtoolsWarning').style.display = 'flex';
                    showSecurityAlert('OUTILS D√âVELOPPEUR D√âTECT√âS', 'Veuillez fermer les outils d√©veloppeur');
                }
            } else {
                if (devToolsOpen) {
                    devToolsOpen = false;
                    document.getElementById('devtoolsWarning').style.display = 'none';
                }
            }
        }

        // PROTECTION MOBILE SP√âCIFIQUE
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            console.log('üì± Mode mobile - Protections mobiles activ√©es');
            
            // Gestes multi-touch
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length >= 3) {
                    e.preventDefault();
                    showSecurityAlert('GESTE MULTI-TOUCH INTERDIT', 'Capture d\'√©cran suspecte');
                }
            });
            
            // Changement d'orientation
            window.addEventListener('orientationchange', function() {
                showSecurityAlert('ROTATION √âCRAN D√âTECT√âE', 'Possible tentative de capture');
            });
            
            // Surveillance visibilit√©
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    console.log('üì± Application mise en arri√®re-plan');
                }
            });
        }

        // SURVEILLANCE CONTINUE
        setInterval(detectDevTools, 500);
        
        // PROTECTION FOCUS
        window.addEventListener('blur', function() {
            console.log('üîç Fen√™tre a perdu le focus');
        });

        // INITIALISATION S√âCURIS√âE
        window.addEventListener('load', function() {
            console.log('‚úÖ PIVAR S√©curis√© - Toutes les protections sont actives');
            
            // Message de bienvenue apr√®s chargement
            setTimeout(() => {
                if (!sessionStorage.getItem('pivar-security-notice')) {
                    showSecurityAlert('BIENVENUE SUR PIVAR', '√âvaluation s√©curis√©e - Respectez les consignes');
                    sessionStorage.setItem('pivar-security-notice', 'shown');
                }
            }, 2000);
        });

        // NETTOYAGE √Ä LA FERMETURE
        window.addEventListener('beforeunload', function(e) {
            console.log('üîö Session PIVAR termin√©e');
        });

        // PROTECTION CONSOLE
        (function() {
            const originalLog = console.log;
            console.log = function() {
                if (arguments[0] && arguments[0].includes && arguments[0].includes('PIVAR')) {
                    originalLog.apply(console, arguments);
                }
            };
        })();

        // MESSAGE DE DISSUASION D√âVELOPPEUR
        console.log('%c‚ö†Ô∏è ATTENTION D√âVELOPPEUR', 'color: red; font-size: 20px; font-weight: bold;');
        console.log('%cToute tentative de modification de cette page est surveill√©e et peut constituer une violation des conditions d\'utilisation.', 'color: orange; font-size: 14px;');
    </script>
</body>
</html>
