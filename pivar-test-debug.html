<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIVAR - Test Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        
        .debug-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .questionnaire-frame {
            width: 100%;
            height: 400px;
            border: 2px solid #007bff;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üõ°Ô∏è PIVAR - Test de Fonctionnement</h1>
        
        <div id="jsTest" class="test-result error">
            ‚ùå JavaScript non charg√©
        </div>
        
        <div id="deviceInfo" class="debug-info">
            Chargement des informations device...
        </div>
        
        <h2>Tests de Protection :</h2>
        
        <button class="test-button" onclick="testRightClick()">Test Clic Droit</button>
        <button class="test-button" onclick="testKeyboard()">Test Ctrl+C</button>
        <button class="test-button" onclick="testSelection()">Test S√©lection</button>
        
        <div id="testResults"></div>
        
        <h2>Iframe Test :</h2>
        <iframe 
            class="questionnaire-frame" 
            src="https://formulaires.pivar.info/r/wMG4Lg"
            title="Test Tally">
        </iframe>
        
        <div id="protectionStatus" class="test-result warning">
            ‚è≥ Tests en attente...
        </div>
    </div>

    <script>
        // TEST 1: JavaScript fonctionne
        console.log('üî• SCRIPT CHARG√â - JavaScript fonctionne !');
        document.getElementById('jsTest').className = 'test-result success';
        document.getElementById('jsTest').textContent = '‚úÖ JavaScript charg√© et fonctionnel';

        // TEST 2: D√©tection device
        const deviceInfo = {
            userAgent: navigator.userAgent,
            screenWidth: window.innerWidth,
            screenHeight: window.innerHeight,
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isTablet: /iPad|Android.*Tablet/i.test(navigator.userAgent),
            platform: navigator.platform,
            touchPoints: navigator.maxTouchPoints || 0
        };

        document.getElementById('deviceInfo').innerHTML = `
            <strong>Informations Device:</strong><br>
            User Agent: ${deviceInfo.userAgent}<br>
            √âcran: ${deviceInfo.screenWidth}x${deviceInfo.screenHeight}<br>
            Mobile d√©tect√©: ${deviceInfo.isMobile}<br>
            Tablette d√©tect√©e: ${deviceInfo.isTablet}<br>
            Plateforme: ${deviceInfo.platform}<br>
            Points tactiles: ${deviceInfo.touchPoints}
        `;

        console.log('üì± Device Info:', deviceInfo);

        // TEST 3: Variables globales
        let testViolations = 0;
        let testResults = [];

        function addTestResult(test, success, details) {
            testViolations++;
            const result = {
                id: testViolations,
                test: test,
                success: success,
                details: details,
                timestamp: new Date().toLocaleTimeString()
            };
            
            testResults.push(result);
            
            const resultDiv = document.getElementById('testResults');
            const resultClass = success ? 'success' : 'error';
            const resultIcon = success ? '‚úÖ' : '‚ùå';
            
            resultDiv.innerHTML += `
                <div class="test-result ${resultClass}">
                    ${resultIcon} Test ${testViolations}: ${test}<br>
                    <small>${details} (${result.timestamp})</small>
                </div>
            `;
            
            console.log(`üß™ TEST ${testViolations}:`, result);
            updateProtectionStatus();
        }

        function updateProtectionStatus() {
            const statusDiv = document.getElementById('protectionStatus');
            const successCount = testResults.filter(r => r.success).length;
            const totalTests = testResults.length;
            
            if (totalTests === 0) {
                statusDiv.className = 'test-result warning';
                statusDiv.textContent = '‚è≥ Aucun test effectu√©';
            } else if (successCount === totalTests) {
                statusDiv.className = 'test-result success';
                statusDiv.textContent = `‚úÖ ${successCount}/${totalTests} protections actives`;
            } else {
                statusDiv.className = 'test-result error';
                statusDiv.textContent = `‚ö†Ô∏è ${successCount}/${totalTests} protections fonctionnent`;
            }
        }

        // TEST 4: Protection clic droit
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            addTestResult('Clic Droit', true, 'Menu contextuel bloqu√© avec succ√®s');
            alert('üõ°Ô∏è PROTECTION ACTIVE: Clic droit bloqu√© !');
            return false;
        });

        function testRightClick() {
            addTestResult('Test Clic Droit', false, 'Faites clic droit n\'importe o√π pour tester');
        }

        // TEST 5: Protection clavier
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && ['c', 'a', 'v', 's', 'p'].includes(e.key.toLowerCase())) {
                e.preventDefault();
                addTestResult('Clavier', true, `Ctrl+${e.key.toUpperCase()} bloqu√© avec succ√®s`);
                alert(`üõ°Ô∏è PROTECTION ACTIVE: Ctrl+${e.key.toUpperCase()} bloqu√© !`);
                return false;
            }
        });

        function testKeyboard() {
            addTestResult('Test Clavier', false, 'Appuyez sur Ctrl+C pour tester');
        }

        // TEST 6: Protection s√©lection
        document.addEventListener('selectstart', function(e) {
            if (!e.target.closest('iframe')) {
                e.preventDefault();
                addTestResult('S√©lection', true, 'S√©lection de texte bloqu√©e avec succ√®s');
                alert('üõ°Ô∏è PROTECTION ACTIVE: S√©lection bloqu√©e !');
                return false;
            }
        });

        function testSelection() {
            addTestResult('Test S√©lection', false, 'Essayez de s√©lectionner ce texte pour tester');
        }

        // TEST 7: Initialisation
        window.addEventListener('load', function() {
            console.log('‚úÖ Page compl√®tement charg√©e');
            addTestResult('Chargement Page', true, 'Page et scripts charg√©s avec succ√®s');
            
            setTimeout(() => {
                if (testResults.length === 1) {
                    addTestResult('Auto-test', false, 'Effectuez les tests manuels ci-dessus');
                }
            }, 2000);
        });

        // TEST 8: Messages console
        console.log('%cüõ°Ô∏è PIVAR TEST DEBUG', 'color: red; font-size: 20px; font-weight: bold;');
        console.log('%cSi vous voyez ce message, JavaScript fonctionne !', 'color: green; font-size: 14px;');
        console.log('%cOuvrez la console (F12) pour voir tous les logs', 'color: blue; font-size: 12px;');

        // TEST 9: Test automatique apr√®s 3 secondes
        setTimeout(() => {
            console.log('ü§ñ Test automatique...');
            
            // Simuler √©v√©nement pour test
            const testEvent = new Event('contextmenu', { bubbles: true, cancelable: true });
            
            // V√©rifier si les event listeners sont actifs
            const hasListeners = getEventListeners ? 
                (getEventListeners(document).contextmenu?.length > 0) : 
                'Impossible de v√©rifier (getEventListeners non disponible)';
            
            console.log('üëÇ Event Listeners actifs:', hasListeners);
            
        }, 3000);
    </script>
</body>
</html>
