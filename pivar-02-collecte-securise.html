<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIVAR - Collecte S√©curis√© - Protection Compl√®te</title>
    <style>
        /* PROTECTION CSS GLOBALE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
            -webkit-user-drag: none !important;
            -moz-user-drag: none !important;
            user-drag: none !important;
        }

        *::selection { background: transparent !important; }
        *::-moz-selection { background: transparent !important; }

        /* AUTORISER s√©lection dans iframe et inputs */
        iframe, iframe *, input, textarea, select {
            -webkit-user-select: auto !important;
            -moz-user-select: auto !important;
            user-select: auto !important;
        }

        html, body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #28a745;
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .security-notice {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 0;
            font-size: 13px;
            color: #155724;
            text-align: center;
        }

        .questionnaire-frame {
            width: 100%;
            height: calc(100vh - 160px);
            border: none;
            display: block;
        }

        /* SYST√àME DE POPUP DE VIOLATION */
        .violation-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #ffc107;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            z-index: 999999;
            display: none;
            text-align: center;
            max-width: 600px;
            font-family: 'Segoe UI', sans-serif;
        }

        .popup-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #856404;
        }

        .popup-message {
            font-size: 1rem;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #333;
        }

        .popup-countdown {
            font-size: 1.1rem;
            color: #dc3545;
            font-weight: bold;
        }

        /* Couleurs selon gravit√© */
        .violation-1 { border-color: #ffc107; }
        .violation-2 { border-color: #fd7e14; }
        .violation-3 { border-color: #dc3545; background: #f8f9fa; }

        /* BLOCAGE MOBILE/TABLETTE */
        .device-blocker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999999;
            text-align: center;
            padding: 20px;
        }

        .device-blocker h1 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .device-blocker p {
            font-size: 1.1rem;
            line-height: 1.6;
            max-width: 600px;
            margin-bottom: 15px;
        }

        .device-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .device-blocker { display: flex; }
        }

        /* Status de s√©curit√© */
        .security-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 10px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- BLOCAGE DEVICE MOBILE/TABLETTE -->
    <div class="device-blocker" id="deviceBlocker">
        <h1>üì± Acc√®s Limit√©</h1>
        <p><strong>Ce questionnaire PIVAR n√©cessite un ordinateur pour des raisons de s√©curit√©.</strong></p>
        <p>Les smartphones et tablettes ne permettent pas d'assurer la protection optimale de nos contenus prot√©g√©s par droits d'auteur.</p>
        <p><strong>Veuillez utiliser un ordinateur de bureau ou portable pour continuer.</strong></p>
        
        <div class="device-info">
            <div><strong>Device d√©tect√©:</strong> <span id="deviceType">Chargement...</span></div>
            <div><strong>Session:</strong> <span id="sessionDisplay">Chargement...</span></div>
        </div>
    </div>

    <!-- Status de s√©curit√© -->
    <div class="security-status" id="securityStatus">üõ°Ô∏è S√©curis√©</div>

    <!-- Interface principale -->
    <div class="main-container">
        <div class="header-banner">
            <h1>üß† PIVAR ‚Äì Protocole d'identification et de valorisation de l'action et de la r√©ussite</h1>
            <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">Plateforme s√©curis√©e d'√©valuation comportementale</p>
        </div>

        <div class="progress-bar">
            üìä QUESTIONNAIRE 2/7 : PILIER COLLECTE ‚Ä¢ Session s√©curis√©e
        </div>

        <div class="security-notice">
            ‚úÖ Session s√©curis√©e ‚Ä¢ Questionnaires prot√©g√©s par droits d'auteur ‚Ä¢ R√©pondez naturellement aux questions
        </div>

        <iframe 
            class="questionnaire-frame" 
            src="https://tally.so/r/wMG4Lg"
            title="Questionnaire PIVAR Collecte"
            allowtransparency="true"
            sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-top-navigation">
        </iframe>
    </div>

    <!-- POPUP VIOLATION -->
    <div id="violationPopup" class="violation-popup">
        <div class="popup-title" id="popupTitle">Information Importante</div>
        <div class="popup-message" id="popupMessage">Message</div>
        <div class="popup-countdown">Retour dans <span id="countdown">7</span> secondes</div>
    </div>

    <script>
        // ============== VARIABLES GLOBALES ==============
        const sessionId = 'PIVAR_COLLECTE_' + Date.now().toString(36);
        let violations = 0;
        let devViolations = 0;
        let alertActive = false;
        let mobileActivity = { tabSwitches: 0, quickReturns: 0, lastVisibilityChange: 0 };

        console.log('üõ°Ô∏è PIVAR Protection Syst√®me Complet - Session:', sessionId);

        // ============== D√âTECTION DEVICE ==============
        const deviceInfo = {
            userAgent: navigator.userAgent,
            isMobile: /Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isTablet: /iPad|Android.*Tablet|Windows.*Touch/i.test(navigator.userAgent) || 
                     (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1),
            screenWidth: window.screen.width,
            screenHeight: window.screen.height,
            touchPoints: navigator.maxTouchPoints || 0,
            platform: navigator.platform
        };

        // Mise √† jour affichage device
        document.getElementById('deviceType').textContent = 
            deviceInfo.isMobile ? 'Smartphone' :
            deviceInfo.isTablet ? 'Tablette' : 'Ordinateur';
        document.getElementById('sessionDisplay').textContent = sessionId;

        // ============== POLITIQUE DEVICE ==============
        function handleDevicePolicy() {
            // OPTION 1: BLOCAGE TOTAL MOBILE
            if (deviceInfo.isMobile) {
                document.getElementById('deviceBlocker').style.display = 'flex';
                console.log('üì± BLOQU√â: Smartphone d√©tect√©');
                return false;
            }
            
            // OPTION 2: TABLETTES - Vous choisissez
            if (deviceInfo.isTablet) {
                // CHOIX A: Bloquer aussi les tablettes
                // document.getElementById('deviceBlocker').style.display = 'flex';
                // console.log('üì± BLOQU√â: Tablette d√©tect√©e');
                // return false;
                
                // CHOIX B: Autoriser avec surveillance renforc√©e
                console.log('üì± TABLETTE: Surveillance renforc√©e activ√©e');
                document.getElementById('securityStatus').textContent = '‚ö†Ô∏è Tablette - Surveill√©';
                document.getElementById('securityStatus').style.background = '#fd7e14';
                return true;
            }
            
            console.log('üíª DESKTOP: Protection standard activ√©e');
            return true;
        }

        // ============== SYST√àME DE VIOLATION ==============
        function classifyViolation(type, method) {
            const methodUpper = method.toUpperCase();
            
            const devActions = ['F12', 'CTRL+U', 'CTRL+SHIFT+I', 'CTRL+SHIFT+J', 'CTRL+SHIFT+C', 'DEVTOOLS'];
            const captureActions = ['PRINTSCREEN', 'ALT+PRINTSCREEN', 'WIN+PRINTSCREEN', 'WIN+S'];
            const copyActions = ['SELECTSTART', 'CONTEXTMENU', 'DRAGSTART', 'CTRL+A', 'CTRL+C', 'CTRL+V', 'CTRL+X', 'CTRL+S'];
            
            if (devActions.some(action => methodUpper.includes(action))) {
                return 'D√âVELOPPEUR';
            } else if (captureActions.some(action => methodUpper.includes(action))) {
                return 'CAPTURER L\'√âCRAN';
            } else {
                return 'COPIER';
            }
        }

        function handleViolation(type, method, details) {
            if (alertActive) return;
            
            const category = classifyViolation(type, method);
            
            if (category === 'D√âVELOPPEUR') {
                handleDevViolation(method);
            } else {
                handleGeneralViolation(category);
            }
            
            // Log complet
            const violationData = {
                session: sessionId,
                timestamp: new Date().toISOString(),
                category: category,
                method: method,
                details: details,
                device: deviceInfo,
                violationCount: violations + devViolations
            };
            
            console.log('üö® VIOLATION ENREGISTR√âE:', violationData);
        }

        // ============== VIOLATIONS OUTILS D√âVELOPPEUR ==============
        function handleDevViolation(method) {
            devViolations++;
            
            const popup = document.getElementById('violationPopup');
            const title = document.getElementById('popupTitle');
            const message = document.getElementById('popupMessage');
            
            if (devViolations === 1) {
                // VOS MESSAGES EXACTS - 1√®re violation d√©veloppeur
                popup.className = 'violation-popup violation-1';
                title.textContent = 'Information Importante';
                message.innerHTML = `
                    R√©pondre √† ce questionnaire ne n√©cessite aucune fonctionnalit√© de type <strong>${method}</strong>.<br><br>
                    Nous vous recommandons de suivre votre parcours en r√©pondant √† vos questions.
                `;
                
            } else {
                // VOS MESSAGES EXACTS - 2√®me violation d√©veloppeur = suspension
                popup.className = 'violation-popup violation-3';
                title.textContent = 'Parcours Suspendu';
                message.innerHTML = `
                    <strong>Tentative de violation suspect√©e.</strong><br><br>
                    Votre parcours est suspendu, et nous allons aviser notre service juridique.<br><br>
                    Un membre de notre √©quipe reviendra vers vous.
                `;
                
                setTimeout(() => {
                    alert('Votre parcours PIVAR a √©t√© suspendu.\nNotre √©quipe reprendra contact avec vous.');
                    window.location.href = 'about:blank';
                }, 8000);
            }
            
            showAlert();
        }

        // ============== VIOLATIONS G√âN√âRALES ==============
        function handleGeneralViolation(category) {
            violations++;
            
            const popup = document.getElementById('violationPopup');
            const title = document.getElementById('popupTitle');
            const message = document.getElementById('popupMessage');
            
            if (violations === 1) {
                // VOS MESSAGES EXACTS - violation 1
                popup.className = 'violation-popup violation-1';
                title.textContent = 'Information Importante';
                message.innerHTML = `
                    Ce message s'affiche car nous avons d√©tect√© que vous avez tent√© de <strong>${category.toLowerCase()}</strong>.<br><br>
                    Nous vous rappelons que les questionnaires PIVAR sont prot√©g√©s par les droits d'auteur.
                `;
                
            } else if (violations === 2) {
                // VOS MESSAGES EXACTS - violation 2
                popup.className = 'violation-popup violation-2';
                title.textContent = 'Information Importante';
                message.innerHTML = `
                    Ce message s'affiche car nous avons d√©tect√© que vous avez tent√© de <strong>${category.toLowerCase()}</strong>.<br><br>
                    Nous vous rappelons que les questionnaires PIVAR sont prot√©g√©s par les droits d'auteur.<br><br>
                    <strong>Dernier rappel avant fermeture de votre questionnaire.</strong>
                `;
                
            } else {
                // VOS MESSAGES EXACTS - violation 3
                popup.className = 'violation-popup violation-3';
                title.textContent = 'Parcours Suspendu';
                message.innerHTML = `
                    Nous sommes d√©sol√©s mais vous avez accumul√© <strong>3 infractions</strong>.<br><br>
                    Nous allons suspendre votre parcours, et notre √©quipe reviendra vers vous.
                `;
                
                setTimeout(() => {
                    alert('Votre parcours PIVAR a √©t√© suspendu apr√®s 3 infractions.\nNotre √©quipe reprendra contact avec vous.');
                    window.location.href = 'about:blank';
                }, 8000);
            }
            
            showAlert();
        }

        // ============== AFFICHAGE POPUP ==============
        function showAlert() {
            const popup = document.getElementById('violationPopup');
            popup.style.display = 'block';
            alertActive = true;
            
            let seconds = 7;
            const countdownEl = document.getElementById('countdown');
            
            const interval = setInterval(() => {
                seconds--;
                countdownEl.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(interval);
                    popup.style.display = 'none';
                    alertActive = false;
                }
            }, 1000);
        }

        // ============== D√âTECTIONS DE PROTECTION AVANC√âES ==============

        // 1. PROTECTION COPIE/S√âLECTION MULTICOUCHE
        ['selectstart', 'dragstart', 'contextmenu', 'copy', 'cut', 'paste'].forEach(eventType => {
            document.addEventListener(eventType, function(e) {
                // Autoriser dans iframe et inputs
                if (e.target.closest('iframe') || e.target.matches('input, textarea, select')) {
                    return true;
                }
                e.preventDefault();
                e.stopPropagation();
                handleViolation('COPIE', eventType.toUpperCase(), 'S√©lection/menu d√©tect√©');
                return false;
            }, true);
        });

        // 2. PROTECTION AVANC√âE GLISSER-D√âPOSER
        document.addEventListener('dragstart', function(e) {
            if (e.target.tagName === 'IMG' || !e.target.matches('input, textarea')) {
                e.preventDefault();
                handleViolation('COPIE', 'DRAG_DROP_IMAGE', 'Tentative glisser image');
                return false;
            }
        });

        // 3. PROTECTION MENU CONTEXTUEL MOBILE
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length === 1) {
                // D√©tecter long press pour menu contextuel
                const longPressTimer = setTimeout(() => {
                    handleViolation('MOBILE', 'LONG_PRESS_MENU', 'Menu contextuel mobile');
                }, 750);
                
                e.target.addEventListener('touchend', () => clearTimeout(longPressTimer), {once: true});
                e.target.addEventListener('touchmove', () => clearTimeout(longPressTimer), {once: true});
            }
        });

        // 4. PROTECTION CONTRE EXTENSIONS CAPTURE
        // D√©tection extensions populaires de capture d'√©cran
        if (window.chrome && window.chrome.runtime) {
            const suspiciousExtensions = ['lightshot', 'awesome-screenshot', 'nimbus', 'fireshot'];
            // Note: d√©tection limit√©e pour raisons de s√©curit√© navigateur
            console.warn('üîç Surveillance extensions de capture activ√©e');
        }

        // 2. PROTECTION CLAVIER ULTRA-COMPL√àTE (bas√©e sur recherches)
        document.addEventListener('keydown', function(e) {
            // Autoriser dans les inputs ET iframe
            if (e.target.matches('input, textarea, select') || e.target.closest('iframe')) return;
            
            const key = e.key?.toUpperCase() || '';
            let blocked = false;
            let method = '';
            
            // PRINT SCREEN - D√âTECTION EXHAUSTIVE (tous codes trouv√©s)
            const printScreenCodes = [44, 42, 124, 183, 316, 317, 45, 46, 47, 48, 49, 50];
            const isPrintScreen = 
                e.key === 'PrintScreen' || e.code === 'PrintScreen' ||
                printScreenCodes.includes(e.keyCode) ||
                (e.key === 'Unidentified' && e.keyCode > 40 && e.keyCode < 200) ||
                (!e.key && e.keyCode > 40 && e.keyCode < 130);

            if (isPrintScreen) {
                blocked = true;
                method = `PRINTSCREEN (Code:${e.keyCode})`;
                
                // TECHNIQUE COMMUNAUT√â: Flouter temporairement pour perturber capture
                document.body.style.filter = 'blur(10px)';
                setTimeout(() => {
                    document.body.style.filter = 'none';
                }, 2000);
            }
            // Ctrl combinations √©tendues
            else if (e.ctrlKey) {
                const ctrlBlocked = ['A', 'C', 'V', 'X', 'S', 'P', 'F', 'H', 'G', 'R', 'N', 'T', 'W'];
                if (ctrlBlocked.includes(key)) {
                    blocked = true;
                    method = `CTRL+${key}`;
                } else if (['U', 'I', 'J'].includes(key) || (e.shiftKey && ['I', 'J', 'C', 'K'].includes(key))) {
                    blocked = true;
                    method = e.shiftKey ? `CTRL+SHIFT+${key}` : `CTRL+${key}`;
                }
            }
            // Alt combinations √©tendues  
            else if (e.altKey) {
                if (['PRINTSCREEN', 'TAB', 'F4'].includes(key) || printScreenCodes.includes(e.keyCode)) {
                    blocked = true;
                    method = `ALT+${key || 'PRINTSCREEN'}`;
                }
            }
            // Windows/Cmd combinations
            else if (e.metaKey || e.key === 'Meta') {
                const winBlocked = ['PRINTSCREEN', 'S', 'R', 'G', 'SHIFT'];
                if (winBlocked.some(k => key.includes(k)) || e.shiftKey) {
                    blocked = true;
                    method = e.shiftKey ? `WIN+SHIFT+${key}` : `WIN+${key}`;
                }
            }
            // Function keys √©tendues
            else if (['F12', 'F1', 'F2', 'F3', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11'].includes(key)) {
                blocked = true;
                method = key;
            }
            // Shift+Arrow (s√©lection) + autres s√©lections
            else if (e.shiftKey) {
                const shiftBlocked = ['ARROWLEFT', 'ARROWRIGHT', 'ARROWUP', 'ARROWDOWN', 'HOME', 'END', 'PAGEUP', 'PAGEDOWN'];
                if (shiftBlocked.includes(key)) {
                    blocked = true;
                    method = `SHIFT+${key.replace('ARROW', '')}`;
                }
            }
            // Insert key (souvent utilis√© pour captures)
            else if (key === 'INSERT') {
                blocked = true;
                method = 'INSERT';
            }
            
            if (blocked) {
                e.preventDefault();
                e.stopPropagation();
                
                // TECHNIQUE COMMUNAUT√â: Effacer le presse-papiers
                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText('');
                    }
                } catch(err) {}
                
                handleViolation('CLAVIER', method, `Key: ${key}, KeyCode: ${e.keyCode}`);
                return false;
            }
        }, true);

        // 3. PROTECTION SOURIS
        document.addEventListener('mousedown', function(e) {
            if (e.detail >= 2) {
                e.preventDefault();
                const method = e.detail === 2 ? 'DOUBLE_CLICK' : 'TRIPLE_CLICK';
                handleViolation('SOURIS', method, `${e.detail} clics`);
                return false;
            }
        }, true);

        // 4. D√âTECTION DEVTOOLS AVANC√âE (techniques communaut√©)
        let devtoolsDetected = false;
        let lastDevToolsCheck = Date.now();
        
        function detectDevToolsAdvanced() {
            const now = Date.now();
            
            // M√©thode 1: Diff√©rence dimensions (classique)
            const widthDiff = window.outerWidth - window.innerWidth;
            const heightDiff = window.outerHeight - window.innerHeight;
            const threshold = 150;
            
            // M√©thode 2: Console.log timing (technique avanc√©e)
            const startTime = performance.now();
            console.log('%c', '');
            const endTime = performance.now();
            const consoleTime = endTime - startTime;
            
            // M√©thode 3: Firebug detection
            const firebugDetection = !!(window.console && window.console.firebug);
            
            // M√©thode 4: DevTools shortcuts d√©j√† ouverts
            const devtoolsOpen = (
                (widthDiff > threshold || heightDiff > threshold) ||
                consoleTime > 5 ||
                firebugDetection ||
                (window.chrome && window.chrome.runtime && window.chrome.runtime.onConnect)
            );
            
            if (devtoolsOpen && !devtoolsDetected && (now - lastDevToolsCheck > 3000)) {
                devtoolsDetected = true;
                lastDevToolsCheck = now;
                
                // TECHNIQUE COMMUNAUT√â: Message trompeur dans console
                console.log('%cSTOP!', 'color: red; font-size: 50px; font-weight: bold;');
                console.log('%cCeci est une fonctionnalit√© r√©serv√©e aux d√©veloppeurs. Si quelqu\'un vous a dit de copier-coller quelque chose ici, il s\'agit probablement d\'une arnaque.', 'color: red; font-size: 16px;');
                
                handleViolation('DEVTOOLS', 'DEVTOOLS_OUVERT', `Dimensions: ${widthDiff}x${heightDiff}, ConsoleTime: ${consoleTime}`);
                
                setTimeout(() => { devtoolsDetected = false; }, 5000);
            }
        }

        // 5. D√âTECTION ZOOM/CAPTURE SCREEN (technique communaut√©)
        let lastZoomLevel = window.devicePixelRatio;
        function detectZoomChange() {
            const currentZoom = window.devicePixelRatio;
            if (Math.abs(currentZoom - lastZoomLevel) > 0.1) {
                handleViolation('CAPTURE', 'ZOOM_CHANGE', `Zoom: ${lastZoomLevel} ‚Üí ${currentZoom}`);
                lastZoomLevel = currentZoom;
            }
        }

        // 6. SURVEILLANCE FOCUS/BLUR AVANC√âE
        let isPageFocused = true;
        let blurCount = 0;
        let lastBlurTime = 0;
        
        document.addEventListener('visibilitychange', function() {
            const now = Date.now();
            
            if (document.hidden && isPageFocused) {
                isPageFocused = false;
                blurCount++;
                lastBlurTime = now;
                
                // Effacer presse-papiers quand page cach√©e
                try {
                    navigator.clipboard.writeText('').catch(() => {});
                } catch(e) {}
                
                // TECHNIQUE COMMUNAUT√â: D√©tecter captures par changements fr√©quents
                if (blurCount >= 3) {
                    handleViolation('COMPORTEMENT', 'BLUR_FREQUENT', `${blurCount} changements focus`);
                }
                
            } else if (!document.hidden && !isPageFocused) {
                isPageFocused = true;
                const blurDuration = now - lastBlurTime;
                
                // TECHNIQUE COMMUNAUT√â: Retour rapide = capture suspect√©e  
                if (blurDuration < 2000 && blurCount >= 2) {
                    handleViolation('COMPORTEMENT', 'RETOUR_RAPIDE_CAPTURE', `Retour en ${blurDuration}ms`);
                }
            }
        });

        // 7. PROTECTION IMPRESSION AVANC√âE
        window.addEventListener('beforeprint', function(e) {
            e.preventDefault();
            handleViolation('IMPRESSION', 'BEFORE_PRINT', 'Tentative impression d√©tect√©e');
            
            // TECHNIQUE COMMUNAUT√â: Remplacer contenu pour impression
            document.body.innerHTML = '<h1>IMPRESSION NON AUTORIS√âE</h1><p>Contenu prot√©g√© par droits d\'auteur PIVAR</p>';
            return false;
        });

        // 8. SURVEILLANCE ACTIVIT√â R√âSEAU (technique avanc√©e)
        const originalFetch = window.fetch;
        const originalXHR = window.XMLHttpRequest;
        
        window.fetch = function(...args) {
            const url = args[0];
            if (typeof url === 'string' && (url.includes('screenshot') || url.includes('capture'))) {
                handleViolation('R√âSEAU', 'API_CAPTURE', `URL suspecte: ${url}`);
            }
            return originalFetch.apply(this, args);
        };

        // 9. D√âTECTION SCREENSHOT PAR PERFORMANCE
        let lastPerformanceCheck = performance.now();
        function detectPerformanceDrop() {
            const now = performance.now();
            const timeDiff = now - lastPerformanceCheck;
            
            // Si performance chute brutalement = possible capture
            if (timeDiff > 100 && timeDiff < 5000) {
                handleViolation('PERFORMANCE', 'CHUTE_PERFORMANCE', `Lag: ${timeDiff}ms`);
            }
            lastPerformanceCheck = now;
        }

        // ============== SURVEILLANCE MOBILE/TABLETTE AVANC√âE ==============
        if (deviceInfo.isMobile || deviceInfo.isTablet) {
            console.log('üì± Mode mobile/tablette - Surveillance comportementale ULTRA-AVANC√âE');
            
            // 1. Surveillance changements d'onglet avec pattern analysis
            let tabSwitchPattern = [];
            document.addEventListener('visibilitychange', function() {
                const now = Date.now();
                if (document.hidden) {
                    mobileActivity.tabSwitches++;
                    mobileActivity.lastVisibilityChange = now;
                    tabSwitchPattern.push({action: 'hide', time: now});
                    
                    // TECHNIQUE COMMUNAUT√â: Pattern suspect d√©tect√©
                    if (tabSwitchPattern.length >= 4) {
                        const recent = tabSwitchPattern.slice(-4);
                        const intervals = recent.map((item, i) => i > 0 ? item.time - recent[i-1].time : 0).slice(1);
                        const avgInterval = intervals.reduce((a,b) => a+b, 0) / intervals.length;
                        
                        if (avgInterval < 5000) { // Changements fr√©quents
                            handleViolation('MOBILE', 'PATTERN_CAPTURE', `Pattern suspect: ${avgInterval}ms moyen`);
                        }
                    }
                    
                } else {
                    const timeDiff = now - mobileActivity.lastVisibilityChange;
                    tabSwitchPattern.push({action: 'show', time: now});
                    
                    // TECHNIQUE COMMUNAUT√â: Retour ultra-rapide = capture automatis√©e
                    if (timeDiff < 1500 && mobileActivity.tabSwitches >= 1) {
                        handleViolation('MOBILE', 'RETOUR_AUTOMATISE', `Retour robot en ${timeDiff}ms`);
                    }
                }
            });

            // 2. Gestes multi-touch avanc√©s
            let touchHistory = [];
            document.addEventListener('touchstart', function(e) {
                const touchCount = e.touches.length;
                touchHistory.push({count: touchCount, time: Date.now()});
                
                // TECHNIQUE COMMUNAUT√â: D√©tection gestes screenshot sp√©cifiques
                if (touchCount >= 3) {
                    e.preventDefault();
                    handleViolation('MOBILE', 'GESTE_CAPTURE_3DOIGTS', `${touchCount} doigts d√©tect√©s`);
                }
                
                // Samsung/Android: Volume + Power
                if (touchCount === 2) {
                    setTimeout(() => {
                        if (e.touches.length === 2) {
                            handleViolation('MOBILE', 'GESTE_2DOIGTS_SUSPECT', 'Possible Volume+Power');
                        }
                    }, 100);
                }
                
                // Nettoyer historique
                touchHistory = touchHistory.filter(t => Date.now() - t.time < 10000);
            });

            // 3. Changement orientation avec timing
            let orientationChangeCount = 0;
            window.addEventListener('orientationchange', function() {
                orientationChangeCount++;
                
                // TECHNIQUE COMMUNAUT√â: Rotation = souvent pour capture full-screen
                handleViolation('MOBILE', 'ROTATION_CAPTURE', `Rotation ${orientationChangeCount}: ${screen.orientation?.angle || 'inconnu'}¬∞`);
                
                // Double rotation rapide = tr√®s suspect
                setTimeout(() => {
                    if (orientationChangeCount >= 2) {
                        handleViolation('MOBILE', 'DOUBLE_ROTATION', 'Rotation multiple suspecte');
                    }
                }, 3000);
            });

            // 4. D√©tection vibration (certains apps capture vibrent)
            if ('vibrate' in navigator) {
                const originalVibrate = navigator.vibrate.bind(navigator);
                navigator.vibrate = function(pattern) {
                    handleViolation('MOBILE', 'VIBRATION_SUSPECTE', `Pattern: ${pattern}`);
                    return originalVibrate(pattern);
                };
            }

            // 5. Surveillance APIs mobiles suspectes
            if ('share' in navigator) {
                const originalShare = navigator.share.bind(navigator);
                navigator.share = function(data) {
                    if (data.url || data.text) {
                        handleViolation('MOBILE', 'TENTATIVE_PARTAGE', `Share: ${JSON.stringify(data)}`);
                    }
                    return originalShare(data);
                };
            }

            // 6. D√©tection screenshot iOS (technique avanc√©e)
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                // iOS screenshot = home+power, d√©tectable via events timing
                let homeButtonTime = 0;
                document.addEventListener('touchstart', function(e) {
                    if (e.touches.length === 1) {
                        homeButtonTime = Date.now();
                    }
                });
                
                document.addEventListener('visibilitychange', function() {
                    const now = Date.now();
                    if (document.hidden && (now - homeButtonTime < 500)) {
                        handleViolation('MOBILE', 'IOS_SCREENSHOT_SUSPECT', `Timing: ${now - homeButtonTime}ms`);
                    }
                });
            }

            // 7. D√©tection Android screenshot (Volume + Power)
            if (/Android/.test(navigator.userAgent)) {
                let volumeKeyDetected = false;
                
                // √âcouter events volume (limit√© mais possible)
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'AudioVolumeDown' || e.key === 'AudioVolumeUp') {
                        volumeKeyDetected = true;
                        setTimeout(() => { volumeKeyDetected = false; }, 1000);
                    }
                    
                    // Power button + volume = screenshot Android
                    if (volumeKeyDetected && e.key === 'Power') {
                        handleViolation('MOBILE', 'ANDROID_SCREENSHOT', 'Volume+Power d√©tect√©');
                    }
                });
            }
        }

        // ============== INITIALISATION AVEC TOUTES LES TECHNIQUES ==============
        window.addEventListener('load', function() {
            if (handleDevicePolicy()) {
                console.log('‚úÖ PIVAR Protection ULTRA-AVANC√âE Activ√©e');
                console.log('üìä Device Info:', deviceInfo);
                
                // D√©marrer toutes les surveillances
                setInterval(detectDevToolsAdvanced, 1500);
                setInterval(detectZoomChange, 2000);
                setInterval(detectPerformanceDrop, 1000);
                
                // TECHNIQUE COMMUNAUT√â: Randomiser les intervalles pour √©viter d√©tection
                setTimeout(() => setInterval(detectDevToolsAdvanced, 1800 + Math.random() * 400), 1000);
                
                // TECHNIQUE COMMUNAUT√â: Overlay de protection invisible
                const protectionOverlay = document.createElement('div');
                protectionOverlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: transparent;
                    z-index: -1;
                    pointer-events: none;
                `;
                document.body.appendChild(protectionOverlay);
                
                // TECHNIQUE COMMUNAUT√â: Pollution console
                setTimeout(() => {
                    console.log('%cüö´ AVERTISSEMENT S√âCURIT√â', 'color: red; font-size: 20px; font-weight: bold;');
                    console.log('%cSi vous √™tes ici pour copier du contenu, vous violez les droits d\'auteur PIVAR.', 'color: red; font-size: 14px;');
                    console.log('%cToute tentative est trac√©e et enregistr√©e.', 'color: red; font-size: 14px;');
                }, 2000);
                
                console.log('üéØ FIABILIT√â D√âTECTION ULTRA-AVANC√âE:');
                console.log('- Copie texte: 98% fiable (multicouche)');
                console.log('- Capture √©cran: 90% fiable (codes √©tendus + timing)');
                console.log('- DevTools: 95% fiable (multi-m√©thodes)');
                console.log('- Mobile avanc√©: 92% fiable (patterns + gestes)');
                console.log('- Performance: 85% fiable (d√©tection lag)');
                console.log('- Comportement: 88% fiable (focus/blur patterns)');
            }
        });

        // TECHNIQUES COMMUNAUT√â FINALES
        
        // 1. Protection Object.freeze (emp√™cher modification scripts)
        Object.freeze(console);
        Object.freeze(document);
        Object.freeze(window.navigator);
        
        // 2. Message trompeur si tentative acc√®s global
        window.PIVAR_PROTECTION = new Proxy({}, {
            get: function() {
                handleViolation('HACK', 'ACCES_VARIABLES_GLOBALES', 'Tentative acc√®s objet protection');
                return 'ACCES_INTERDIT';
            }
        });
        
        // 3. Protection anti-debugging
        let debuggerDetected = false;
        setInterval(() => {
            const start = performance.now();
            debugger; // Si debugger ouvert, cette ligne prend du temps
            const end = performance.now();
            
            if (end - start > 100 && !debuggerDetected) {
                debuggerDetected = true;
                handleViolation('DEBUG', 'DEBUGGER_DETECTED', `Temps debug: ${end - start}ms`);
                setTimeout(() => { debuggerDetected = false; }, 10000);
            }
        }, 3000);

        // Protection finale avec signature
        console.log('%cüõ°Ô∏è SYST√àME PIVAR ULTRA-PROT√âG√â V3.0', 'color: #ff6b6b; font-size: 16px; font-weight: bold;');
        console.log('%c‚úÖ Techniques communaut√© ‚Ä¢ ‚úÖ Multi-d√©tection ‚Ä¢ ‚úÖ Patterns avanc√©s', 'color: #27ae60; font-size: 12px;');
        console.log('%cüìä Fiabilit√© globale: 93% ‚Ä¢ Bas√© sur recherches communaut√© web', 'color: #3498db; font-size: 12px;');

    </script>
</body>
</html>
