<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIVAR - √âvaluation Cognitive S√©curis√©e</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Protection anti-s√©lection UNIQUEMENT sur le contenu statique */
        .protected-content {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Autoriser la s√©lection dans les √©l√©ments interactifs */
        input, textarea, [contenteditable="true"], button, select {
            user-select: text !important;
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            margin: 0;
        }

        .header-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-banner h1 {
            font-size: 20px;
            margin: 0;
        }

        .progress-bar {
            background: #28a745;
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: calc(100vh - 100px);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .security-notice {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 0;
            font-size: 13px;
            color: #155724;
            text-align: center;
        }

        .questionnaire-frame {
            width: 100%;
            height: calc(100vh - 160px);
            border: none;
            display: block;
        }

        .footer {
            background: #f8f9fa;
            text-align: center;
            padding: 10px;
            font-size: 12px;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }

        /* Styles mobiles */
        @media (max-width: 768px) {
            .header-banner h1 {
                font-size: 16px;
            }
            .progress-bar {
                font-size: 12px;
                padding: 6px;
            }
            .questionnaire-frame {
                height: calc(100vh - 140px);
            }
        }

        /* Protection discr√®te contre la s√©lection du contenu de navigation */
        .header-banner, .progress-bar, .security-notice, .footer {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>
<body>
    <!-- En-t√™te professionnel PIVAR -->
    <div class="header-banner">
        <h1>üß† PIVAR - √âvaluation Cognitive Professionnelle</h1>
        <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">Plateforme s√©curis√©e d'√©valuation comportementale</p>
    </div>

    <!-- Barre de progression -->
    <div class="progress-bar">
        üìä QUESTIONNAIRE 1/7 : ACCUEIL PIVAR ‚Ä¢ Session s√©curis√©e ‚Ä¢ Dur√©e estim√©e : 5 minutes
    </div>

    <!-- Conteneur principal -->
    <div class="main-container">
        <!-- Notice de s√©curit√© discr√®te -->
        <div class="security-notice">
            ‚úÖ Session s√©curis√©e active ‚Ä¢ Vos donn√©es sont prot√©g√©es ‚Ä¢ √âvaluation confidentielle
        </div>

        <!-- Questionnaire Tally int√©gr√© -->
        <iframe 
            class="questionnaire-frame" 
            src="https://formulaires.pivar.info/r/mJog7Y"
            title="Questionnaire PIVAR S√©curis√©"
            allowtransparency="true">
        </iframe>

        <!-- Pied de page -->
        <div class="footer">
            PIVAR ¬© 2025 ‚Ä¢ √âvaluation cognitive s√©curis√©e ‚Ä¢ Toute reproduction interdite
        </div>
    </div>

    <script>
        // Configuration des protections (sensibilit√© r√©duite)
        const PIVAR_SECURITY = {
            enableWarnings: true,
            silentMode: false,
            logViolations: true
        };

        console.log('üõ°Ô∏è PIVAR Security Layer - Mode Production');
        console.log('üìä Session initialis√©e:', {
            questionnaire: 'ACCUEIL',
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent.substring(0, 50) + '...'
        });

        // Protection Print Screen (toujours bloqu√©)
        document.addEventListener('keydown', function(e) {
            // Actions TOUJOURS bloqu√©es
            const alwaysBlocked = [
                'PrintScreen'
            ];

            // Actions bloqu√©es UNIQUEMENT si pas dans un champ de saisie
            const contextuallyBlocked = [
                (e.ctrlKey && e.key === 'c'),  // Ctrl+C
                (e.ctrlKey && e.key === 'a'),  // Ctrl+A  
                (e.ctrlKey && e.key === 's'),  // Ctrl+S
                (e.key === 'F12'),             // DevTools
                (e.ctrlKey && e.shiftKey && e.key === 'I'), // DevTools
                (e.ctrlKey && e.key === 'u')   // Voir source
            ];

            // V√©rifier si on est dans un √©l√©ment interactif
            const isInInteractiveElement = e.target.matches('input, textarea, select, button, [contenteditable="true"]') ||
                                         e.target.closest('iframe');

            // Bloquer Print Screen dans tous les cas
            if (alwaysBlocked.includes(e.key)) {
                e.preventDefault();
                e.stopPropagation();
                
                if (PIVAR_SECURITY.enableWarnings) {
                    showSecurityNotice('Les captures d\'√©cran sont d√©sactiv√©es pour prot√©ger le contenu de cette √©valuation.');
                }
                
                logSecurityEvent('PRINT_SCREEN_BLOCKED', e.key);
                return false;
            }

            // Bloquer les autres actions SEULEMENT si pas dans un champ interactif
            if (!isInInteractiveElement && contextuallyBlocked.some(condition => condition)) {
                e.preventDefault();
                e.stopPropagation();
                
                if (PIVAR_SECURITY.enableWarnings && !PIVAR_SECURITY.silentMode) {
                    showSecurityNotice('Cette action est limit√©e pendant l\'√©valuation. Vous pouvez saisir normalement dans les champs de r√©ponse.');
                }
                
                logSecurityEvent('ACTION_BLOCKED', e.key);
                return false;
            }
        }, true);

        // Protection clic-droit contextuelle
        document.addEventListener('contextmenu', function(e) {
            const isInInteractiveElement = e.target.matches('input, textarea, select') ||
                                         e.target.closest('iframe');
            
            if (!isInInteractiveElement) {
                e.preventDefault();
                
                if (PIVAR_SECURITY.enableWarnings) {
                    showSecurityNotice('Le menu contextuel est d√©sactiv√© pendant l\'√©valuation.');
                }
                
                logSecurityEvent('RIGHT_CLICK_BLOCKED', 'contextmenu');
                return false;
            }
        });

        // Protection s√©lection de texte (uniquement contenu de navigation)
        document.addEventListener('selectstart', function(e) {
            if (e.target.closest('.protected-content, .header-banner, .progress-bar, .security-notice, .footer')) {
                e.preventDefault();
                return false;
            }
        });

        // Surveillance DevTools (mode discret)
        let devToolsDetected = false;
        setInterval(function() {
            const heightDiff = window.outerHeight - window.innerHeight;
            const widthDiff = window.outerWidth - window.innerWidth;
            
            if ((heightDiff > 200 || widthDiff > 200) && !devToolsDetected) {
                devToolsDetected = true;
                logSecurityEvent('DEVTOOLS_DETECTED', 'height_width_change');
                
                // Notice discr√®te (pas d'alerte agressive)
                if (PIVAR_SECURITY.enableWarnings) {
                    showSecurityNotice('Outils de d√©veloppement d√©tect√©s. L\'√©valuation reste valide.');
                }
                
                // Reset apr√®s 5 secondes
                setTimeout(() => { devToolsDetected = false; }, 5000);
            }
        }, 3000);

        // Protection changement de fen√™tre (floutage l√©ger)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.body.style.filter = 'blur(3px)';
                logSecurityEvent('WINDOW_HIDDEN', 'visibility_change');
            } else {
                document.body.style.filter = 'none';
            }
        });

        // Fonction d'affichage des notices (non-invasive)
        function showSecurityNotice(message) {
            // Cr√©er une notification discr√®te
            const notice = document.createElement('div');
            notice.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(40, 167, 69, 0.95);
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 13px;
                max-width: 300px;
                z-index: 999999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                line-height: 1.4;
            `;
            notice.textContent = message;
            
            document.body.appendChild(notice);
            
            // Retirer apr√®s 4 secondes
            setTimeout(() => {
                if (notice.parentNode) {
                    notice.parentNode.removeChild(notice);
                }
            }, 4000);
        }

        // Logging des √©v√©nements de s√©curit√©
        function logSecurityEvent(eventType, details) {
            if (PIVAR_SECURITY.logViolations) {
                const event = {
                    type: eventType,
                    details: details,
                    timestamp: new Date().toISOString(),
                    questionnaire: 'ACCUEIL',
                    url: window.location.href,
                    userAgent: navigator.userAgent.substring(0, 100)
                };
                
                console.warn('üîí PIVAR Security Event:', event);
                
                // Ici vous pourriez envoyer les logs √† votre serveur
                // fetch('/api/security-log', { method: 'POST', body: JSON.stringify(event) });
            }
        }

        // Message de bienvenue (une seule fois)
        setTimeout(() => {
            if (!sessionStorage.getItem('pivar-welcome-shown')) {
                showSecurityNotice('Bienvenue dans votre √©valuation PIVAR s√©curis√©e. R√©pondez naturellement aux questions.');
                sessionStorage.setItem('pivar-welcome-shown', 'true');
            }
        }, 2000);

        // Nettoyage √† la fermeture
        window.addEventListener('beforeunload', function() {
            logSecurityEvent('SESSION_END', 'page_unload');
        });
    </script>
</body>
</html>