<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIVAR - Test Debug Protections</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            padding: 20px;
        }

        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .test-section {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }

        .test-button {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .test-button:hover {
            background: #218838;
        }

        .result {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            height: 200px;
            overflow-y: scroll;
            font-family: monospace;
            font-size: 12px;
        }

        .notification-area {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 10000;
        }

        .notification {
            background: #28a745;
            color: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transform: translateX(320px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .test-text {
            background: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üõ°Ô∏è PIVAR - Test Debug Protections</h1>
        <p><strong>Objectif :</strong> Tester chaque protection individuellement</p>

        <div class="test-section">
            <h3>üìä Status Syst√®me</h3>
            <div id="systemStatus">Initialisation...</div>
        </div>

        <div class="test-section">
            <h3>üß™ Tests Manuels</h3>
            
            <h4>Test 1: Print Screen (toutes combinaisons)</h4>
            <p>Testez : <code>Print Screen</code>, <code>Ctrl+Alt+Print Screen</code>, <code>Alt+Print Screen</code></p>
            <div id="printScreenResult" class="result">‚ùå Pas encore test√©</div>
            
            <h4>Test 2: Copie de texte</h4>
            <div class="test-text">
                üìù TEXTE √Ä COPIER : S√©lectionnez ce texte et appuyez Ctrl+C
            </div>
            <div id="copyResult" class="result">‚ùå Pas encore test√©</div>
            
            <h4>Test 3: Clic-droit</h4>
            <div class="test-text">
                üëÜ ZONE CLIC-DROIT : Faites un clic-droit ici
            </div>
            <div id="rightClickResult" class="result">‚ùå Pas encore test√©</div>
            
            <h4>Test 4: Outils d√©veloppeur</h4>
            <p>Appuyez sur <code>F12</code></p>
            <div id="devToolsResult" class="result">‚ùå Pas encore test√©</div>
            
            <h4>Test 5: Saisie normale (doit fonctionner)</h4>
            <input type="text" placeholder="Tapez ici - ceci doit fonctionner normalement">
            <textarea placeholder="Zone de texte - ceci doit aussi fonctionner"></textarea>
        </div>

        <div class="test-section">
            <h3>üß∞ Tests Automatiques</h3>
            <button class="test-button" onclick="testPrintScreen()">Simuler Print Screen</button>
            <button class="test-button" onclick="testCtrlAltPrintScreen()">Simuler Ctrl+Alt+PrtSc</button>
            <button class="test-button" onclick="testCopyEvent()">Simuler Ctrl+C</button>
            <button class="test-button" onclick="testRightClick()">Simuler Clic-droit</button>
            <button class="test-button" onclick="testF12()">Simuler F12</button>
            <button class="test-button" onclick="clearLog()">Effacer Log</button>
        </div>

        <div class="test-section">
            <h3>üìù Journal des √âv√©nements</h3>
            <div id="logArea" class="log-area"></div>
        </div>
    </div>

    <div class="notification-area" id="notificationArea"></div>

    <script>
        // Variables globales
        let testResults = {
            printScreen: false,
            copy: false,
            rightClick: false,
            devTools: false
        };

        // Fonction de log
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`PIVAR Debug: ${message}`);
        }

        // Fonction de notification
        function showNotification(message, type = 'success') {
            const notificationArea = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.background = type === 'error' ? '#dc3545' : '#28a745';
            notification.textContent = message;
            
            notificationArea.appendChild(notification);
            
            // Animation d'entr√©e
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Suppression automatique
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notificationArea.removeChild(notification);
                }, 300);
            }, 3000);
            
            addLog(`Notification affich√©e: ${message}`, 'success');
        }

        // Mise √† jour du statut
        function updateStatus() {
            const status = document.getElementById('systemStatus');
            const passed = Object.values(testResults).filter(r => r).length;
            const total = Object.keys(testResults).length;
            
            status.innerHTML = `
                <strong>Tests r√©ussis:</strong> ${passed}/${total}<br>
                <strong>Print Screen:</strong> ${testResults.printScreen ? '‚úÖ' : '‚ùå'}<br>
                <strong>Copie:</strong> ${testResults.copy ? '‚úÖ' : '‚ùå'}<br>
                <strong>Clic-droit:</strong> ${testResults.rightClick ? '‚úÖ' : '‚ùå'}<br>
                <strong>DevTools:</strong> ${testResults.devTools ? '‚úÖ' : '‚ùå'}
            `;
        }

        // Tests automatiques
        function testPrintScreen() {
            addLog('Test automatique Print Screen lanc√©');
            const event = new KeyboardEvent('keydown', { key: 'PrintScreen', code: 'PrintScreen' });
            document.dispatchEvent(event);
        }

        function testCtrlAltPrintScreen() {
            addLog('Test automatique Ctrl+Alt+Print Screen lanc√©');
            const event = new KeyboardEvent('keydown', { 
                key: 'PrintScreen', 
                code: 'PrintScreen',
                ctrlKey: true,
                altKey: true
            });
            document.dispatchEvent(event);
        }

        function testCopyEvent() {
            addLog('Test automatique Ctrl+C lanc√©');
            const event = new KeyboardEvent('keydown', { key: 'c', ctrlKey: true });
            document.dispatchEvent(event);
        }

        function testRightClick() {
            addLog('Test automatique clic-droit lanc√©');
            const event = new MouseEvent('contextmenu', { bubbles: true });
            document.querySelector('.test-text').dispatchEvent(event);
        }

        function testF12() {
            addLog('Test automatique F12 lanc√©');
            const event = new KeyboardEvent('keydown', { key: 'F12' });
            document.dispatchEvent(event);
        }

        function clearLog() {
            const logArea = document.getElementById('logArea');
            logArea.innerHTML = '';
            addLog('Journal effac√© - Protections toujours actives');
        }

        // D√âTECTION MOBILE ET RESTRICTIONS SP√âCIFIQUES
        function detectMobileDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isTablet = /iPad|Android(?=.*Mobile)/i.test(navigator.userAgent);
            
            if (isMobile || isTablet) {
                addLog('‚ö†Ô∏è APPAREIL MOBILE D√âTECT√â - Restrictions renforc√©es activ√©es', 'error');
                
                // Interface d'avertissement mobile
                showNotification('üì± MOBILE D√âTECT√â - Surveillance renforc√©e active');
                
                // Bloquer l'orientation pour √©viter les captures "accidentelles"
                screen.orientation?.lock?.('portrait').catch(() => {});
                
                // Surveillance sp√©ciale mobile
                startMobileSurveillance();
                
                return true;
            }
            return false;
        }

        function startMobileSurveillance() {
            // Surveillance changements d'orientation (souvent = screenshot)
            window.addEventListener('orientationchange', function() {
                addLog('üö® CHANGEMENT ORIENTATION - Possible tentative capture mobile', 'error');
                setTimeout(async () => {
                    try {
                        await navigator.clipboard.writeText('üì± CAPTURE MOBILE D√âTECT√âE - Session PIVAR surveill√©e - Toute reproduction est interdite');
                    } catch (err) {}
                }, 500);
            });

            // Surveillance perte de focus (commun lors de screenshots mobiles)
            let focusLossCount = 0;
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    focusLossCount++;
                    if (focusLossCount > 2) {
                        addLog(`üö® MOBILE: ${focusLossCount}e perte de focus - Activit√© tr√®s suspecte`, 'error');
                        suspiciousActivity += 2;
                    }
                }
            });

            // D√©tection vibration (certains mobiles vibrent lors de screenshots)
            if ('vibrate' in navigator) {
                // Surveillance des patterns de vibration suspects
                addLog('Surveillance vibration mobile activ√©e', 'info');
            }
        }
        let clipboardMonitor;
        
        function startClipboardMonitoring() {
            clipboardMonitor = setInterval(async () => {
                try {
                    if (navigator.clipboard && navigator.clipboard.readText) {
                        const clipContent = await navigator.clipboard.readText();
                        if (clipContent && clipContent.length > 10 && !clipContent.includes('PIVAR')) {
                            // Contenu suspect d√©tect√©, remplacer
                            await navigator.clipboard.writeText('üö® CONTENU PROT√âG√â D√âTECT√â - Session PIVAR surveill√©e - Contact: securite@pivar.info');
                            addLog('‚ö†Ô∏è Contenu suspect dans presse-papier remplac√©', 'error');
                        }
                    }
                } catch (err) {
                    // Permission refus√©e ou pas support√©
                }
            }, 2000); // V√©rification toutes les 2 secondes
        }

        // PROTECTION ANTI-SCREENSHOT MOBILE AVANC√âE
        function addMobileProtections() {
            // CSS sp√©cial mobile pour rendre les captures difficiles
            const mobileStyle = document.createElement('style');
            mobileStyle.innerHTML = `
                @media screen and (max-width: 768px) {
                    body::before {
                        content: "SESSION PIVAR S√âCURIS√âE";
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%) rotate(-45deg);
                        font-size: 4rem;
                        color: rgba(255, 0, 0, 0.1);
                        z-index: 9999;
                        pointer-events: none;
                        font-weight: bold;
                    }
                    
                    body {
                        -webkit-touch-callout: none;
                        -webkit-user-select: none;
                        -webkit-tap-highlight-color: transparent;
                    }
                }
            `;
            document.head.appendChild(mobileStyle);

            // Surveillance tactile suspecte
            let touchCount = 0;
            document.addEventListener('touchstart', function(e) {
                touchCount++;
                if (e.touches.length >= 3) {
                    addLog('üö® MOBILE: Geste multi-touch suspect d√©tect√©', 'error');
                    suspiciousActivity++;
                }
            });

            // D√©tection tentatives de zoom (souvent avant screenshot)
            let lastScale = 1;
            document.addEventListener('touchmove', function(e) {
                if (e.touches.length === 2) {
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    const distance = Math.sqrt(
                        Math.pow(touch2.pageX - touch1.pageX, 2) +
                        Math.pow(touch2.pageY - touch1.pageY, 2)
                    );
                    
                    if (Math.abs(distance - lastScale) > 50) {
                        addLog('üö® MOBILE: Tentative de zoom d√©tect√©e - Possible pr√©paration capture', 'error');
                        suspiciousActivity++;
                    }
                    lastScale = distance;
                }
            });
        }
        setTimeout(() => {
            if (navigator.clipboard) {
                startClipboardMonitoring();
                addLog('Surveillance presse-papier activ√©e', 'success');
            }
        }, 3000);
        let suspiciousActivity = 0;
        
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                suspiciousActivity++;
                addLog(`‚ö†Ô∏è ALERTE: Utilisateur a quitt√© l'onglet (${suspiciousActivity}e fois) - Activit√© suspecte`, 'error');
                
                // Tentative de nettoyage pr√©ventif du presse-papier
                setTimeout(async () => {
                    try {
                        await navigator.clipboard.writeText('üö® SESSION PIVAR SURVEILL√âE - Toute reproduction est trac√©e et interdite');
                        addLog('Presse-papier remplac√© pr√©ventivement', 'success');
                    } catch (err) {
                        addLog('Surveillance active - Restriction presse-papier', 'info');
                    }
                }, 50);
            } else {
                addLog('Retour sur l\'onglet - Surveillance continue', 'info');
            }
        });

        window.addEventListener('blur', function() {
            addLog('‚ö†Ô∏è Fen√™tre perdue (Alt+Tab ou clic ailleurs) - Activit√© surveill√©e', 'error');
            suspiciousActivity++;
        });

        window.addEventListener('focus', function() {
            addLog('Retour focus fen√™tre - Contr√¥le repris', 'info');
        });

        // PROTECTION MAXIMALE - Tentative de vidage presse-papier
        async function clearClipboard() {
            try {
                // Tentative de vider le presse-papier (Chrome/Edge moderne)
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText('');
                    addLog('Presse-papier vid√© apr√®s d√©tection Print Screen', 'success');
                }
            } catch (err) {
                addLog('Impossible de vider le presse-papier (restrictions navigateur)', 'info');
            }
        }

        // PROTECTION RENFORC√âE Print Screen
        document.addEventListener('keydown', function(e) {
            addLog(`Touche d√©tect√©e: ${e.key} ${e.ctrlKey ? '+ Ctrl' : ''} ${e.shiftKey ? '+ Shift' : ''} ${e.altKey ? '+ Alt' : ''} ${e.metaKey ? '+ Win' : ''}`, 'info');
            
            // Print Screen (toutes combinaisons) - D√âTECTION MAXIMALE
            if (e.key === 'PrintScreen' || e.code === 'PrintScreen' || e.keyCode === 44) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                
                // Tentative de vidage imm√©diat du presse-papier
                clearClipboard();
                
                testResults.printScreen = true;
                document.getElementById('printScreenResult').style.display = 'block';
                document.getElementById('printScreenResult').textContent = '‚úÖ Print Screen BLOQU√â + Presse-papier vid√©';
                
                let combo = 'Print Screen';
                if (e.ctrlKey && e.altKey) combo = 'Ctrl+Alt+Print Screen';
                else if (e.altKey) combo = 'Alt+Print Screen';
                else if (e.ctrlKey) combo = 'Ctrl+Print Screen';
                else if (e.metaKey) combo = 'Win+Print Screen';
                
                showNotification(`üö´ ${combo} bloqu√© + Presse-papier effac√©`);
                addLog(`${combo} bloqu√© avec tentative de vidage presse-papier`, 'success');
                updateStatus();
                
                // Remplacement du contenu presse-papier par un message d'avertissement
                setTimeout(async () => {
                    try {
                        await navigator.clipboard.writeText('‚ö†Ô∏è CONTENU PROT√âG√â PIVAR - Reproduction interdite - Session surveill√©e');
                        addLog('Presse-papier remplac√© par message d\'avertissement', 'success');
                    } catch (err) {
                        addLog('Impossible de modifier le presse-papier', 'info');
                    }
                }, 100);
                
                return false;
            }
            
            // BLOCAGE PR√âVENTIF des combinaisons dangereuses
            if ((e.ctrlKey && e.altKey) || (e.altKey && e.key !== 'Tab')) {
                if (e.key !== 'Tab' && e.key !== 'F4') {  // Autoriser Alt+Tab et Alt+F4
                    addLog(`Combinaison suspecte d√©tect√©e: ${e.key} avec modificateurs`, 'success');
                    e.preventDefault();
                    e.stopPropagation();
                    showNotification('üö´ Combinaison de touches bloqu√©e');
                    return false;
                }
            }
            
            // Ctrl+C (si pas dans un champ)
            if (e.ctrlKey && e.key === 'c') {
                const isInInput = e.target.matches('input, textarea, [contenteditable="true"]');
                if (!isInInput) {
                    e.preventDefault();
                    e.stopPropagation();
                    testResults.copy = true;
                    document.getElementById('copyResult').style.display = 'block';
                    document.getElementById('copyResult').textContent = '‚úÖ Copie BLOQU√âE !';
                    showNotification('üìã Copie de texte bloqu√©e !');
                    addLog('Ctrl+C bloqu√© avec succ√®s (hors champ de saisie)', 'success');
                    updateStatus();
                    return false;
                } else {
                    addLog('Ctrl+C autoris√© dans champ de saisie', 'info');
                }
            }
            
            // F12
            if (e.key === 'F12') {
                e.preventDefault();
                e.stopPropagation();
                testResults.devTools = true;
                document.getElementById('devToolsResult').style.display = 'block';
                document.getElementById('devToolsResult').textContent = '‚úÖ F12 BLOQU√â !';
                showNotification('üîß Outils d√©veloppeur bloqu√©s !');
                addLog('F12 bloqu√© avec succ√®s', 'success');
                updateStatus();
                return false;
            }
        }, true);

        // Protection clic-droit
        document.addEventListener('contextmenu', function(e) {
            addLog(`Clic-droit d√©tect√© sur: ${e.target.tagName} ${e.target.className}`, 'info');
            
            const isInInput = e.target.matches('input, textarea, select');
            if (!isInInput) {
                e.preventDefault();
                testResults.rightClick = true;
                document.getElementById('rightClickResult').style.display = 'block';
                document.getElementById('rightClickResult').textContent = '‚úÖ Clic-droit BLOQU√â !';
                showNotification('üëÜ Menu contextuel bloqu√© !');
                addLog('Clic-droit bloqu√© avec succ√®s', 'success');
                updateStatus();
                return false;
            } else {
                addLog('Clic-droit autoris√© dans champ de saisie', 'info');
            }
        });

        // Protection s√©lection
        document.addEventListener('selectstart', function(e) {
            if (e.target.closest('.test-text')) {
                e.preventDefault();
                addLog('S√©lection de texte bloqu√©e', 'success');
                return false;
            }
        });

        // Surveillance DevTools
        let devToolsDetected = false;
        setInterval(function() {
            const heightDiff = window.outerHeight - window.innerHeight;
            const widthDiff = window.outerWidth - window.innerWidth;
            
            if ((heightDiff > 200 || widthDiff > 200) && !devToolsDetected) {
                devToolsDetected = true;
                showNotification('üîç DevTools d√©tect√©s par surveillance !');
                addLog('DevTools d√©tect√©s par surveillance des dimensions', 'success');
            } else if (heightDiff <= 200 && widthDiff <= 200 && devToolsDetected) {
                devToolsDetected = false;
                addLog('DevTools ferm√©s (surveillance)', 'info');
            }
        }, 1000);

        // INITIALISATION COMPL√àTE DES PROTECTIONS
        window.addEventListener('load', function() {
            addLog('Page charg√©e - Protections actives', 'success');
            
            // D√©tection et protection mobile
            const isMobile = detectMobileDevice();
            if (isMobile) {
                addMobileProtections();
                addLog('Protections mobiles sp√©cifiques activ√©es', 'success');
            }
            
            updateStatus();
        });

        // Test de bienvenue
        setTimeout(function() {
            showNotification('üõ°Ô∏è Syst√®me de protection initialis√©');
            addLog('Message de bienvenue affich√©', 'info');
        }, 2000);
    </script>
</body>
</html>
