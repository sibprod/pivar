<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIVAR - Test Overlay Fonctionnel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-zone {
            background: #e9ecef;
            padding: 20px;
            margin: 15px 0;
            border-radius: 4px;
            text-align: center;
            border: 2px dashed #6c757d;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            height: 200px;
            overflow-y: scroll;
            font-family: monospace;
            font-size: 12px;
            margin-top: 20px;
        }

        /* OVERLAY MASSIF */
        .violation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(220, 53, 69, 0.98);
            color: white;
            display: none;
            z-index: 999999;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        .violation-content {
            background: #dc3545;
            padding: 40px;
            border-radius: 15px;
            border: 5px solid #fff;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            max-width: 600px;
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .violation-title {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .violation-message {
            font-size: 1.5rem;
            margin-bottom: 25px;
        }

        .countdown {
            font-size: 2rem;
            color: #ffeb3b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è PIVAR - Test Overlay Simple</h1>
        
        <div style="background: #d4edda; padding: 15px; border-radius: 4px; margin: 20px 0;">
            <strong>üéØ OBJECTIF :</strong> V√©rifier que l'overlay fonctionne sur TOUTES les touches
        </div>

        <div class="test-zone">
            <h3>üß™ ZONE DE TEST</h3>
            <p><strong>Essayez N'IMPORTE QUELLE TOUCHE ici !</strong></p>
            <p>Toute touche devrait d√©clencher l'overlay d'alerte</p>
        </div>

        <div>
            <h4>üìù Test saisie normale (doit fonctionner) :</h4>
            <input type="text" placeholder="Tapez ici - ceci doit fonctionner normalement">
            <textarea placeholder="Zone de texte - ceci doit aussi fonctionner"></textarea>
        </div>

        <button onclick="testOverlay()">üß™ TESTER L'OVERLAY MANUELLEMENT</button>

        <div class="log-area" id="logArea">
            <strong>üìä JOURNAL DES √âV√âNEMENTS :</strong><br>
        </div>
    </div>

    <!-- OVERLAY D'ALERTE -->
    <div id="violationOverlay" class="violation-overlay">
        <div class="violation-content">
            <div class="violation-title">üö® VIOLATION D√âTECT√âE</div>
            <div class="violation-message" id="violationMessage">
                TENTATIVE NON AUTORIS√âE
            </div>
            <div class="countdown">
                Continuez votre √©valuation dans <span id="countdown">5</span>s
            </div>
        </div>
    </div>

    <script>
        function addLog(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`PIVAR: ${message}`);
        }

        function showOverlay(violationType) {
            const overlay = document.getElementById('violationOverlay');
            const messageElement = document.getElementById('violationMessage');
            
            messageElement.innerHTML = `
                <strong>${violationType}</strong><br>
                VOUS VOUS EXPOSEZ √Ä DES SANCTIONS<br>
                SESSION ENREGISTR√âE ET TRAC√âE
            `;
            
            overlay.style.display = 'flex';
            
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    overlay.style.display = 'none';
                }
            }, 1000);
            
            addLog(`üö® OVERLAY AFFICH√â: ${violationType}`);
        }

        function testOverlay() {
            showOverlay('TEST MANUEL');
        }

        // D√âTECTION RENFORC√âE DE TOUTES LES TOUCHES
        document.addEventListener('keydown', function(e) {
            addLog(`Touche: ${e.key} | Ctrl: ${e.ctrlKey} | Alt: ${e.altKey} | Code: ${e.keyCode} | Which: ${e.which} | Location: ${e.location}`);
            
            // Si c'est dans un champ de saisie, autoriser
            const isInInput = e.target.matches('input, textarea, select');
            if (isInInput) {
                addLog(`‚úÖ Saisie autoris√©e dans champ`);
                return;
            }
            
            // TESTER TOUTES LES TOUCHES SUSPECTES
            let violationType = null;
            
            // Print Screen - D√âTECTION √âLARGIE MAXIMALE
            const isPrintScreen = 
                e.key === 'PrintScreen' ||
                e.code === 'PrintScreen' ||
                e.key === 'Print' ||
                e.code === 'Print' ||
                e.keyCode === 44 ||
                e.keyCode === 42 ||
                e.keyCode === 124 ||
                e.keyCode === 183 ||
                e.which === 44 ||
                e.which === 42 ||
                e.which === 124 ||
                e.which === 183 ||
                // Codes √©tendus pour diff√©rents claviers
                (e.keyCode >= 40 && e.keyCode <= 50) ||
                (e.which >= 40 && e.which <= 50) ||
                // Touches sans nom mais dans la zone Print Screen
                (!e.key && e.keyCode > 40 && e.keyCode < 200) ||
                (e.key === 'Unidentified' && e.keyCode > 40) ||
                // D√©tection par position (apr√®s F12)
                (e.location === 0 && e.keyCode > 122 && e.keyCode < 130) ||
                // Noms alternatifs
                e.key?.includes('Print') ||
                e.code?.includes('Print') ||
                e.key?.includes('Impr') ||
                e.code?.includes('Impr');

            if (isPrintScreen) {
                violationType = `CAPTURE D'√âCRAN INTERDITE`;
                addLog(`üéØ PRINT SCREEN D√âTECT√â! Key: "${e.key}", Code: ${e.keyCode}, Which: ${e.which}`);
            }
            
            // Ctrl + quelque chose
            else if (e.ctrlKey) {
                violationType = `CTRL+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
            }
            
            // Alt + quelque chose
            else if (e.altKey) {
                violationType = `ALT+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
            }
            
            // Touches F (sauf F5)
            else if (e.key?.startsWith('F') && e.key !== 'F5') {
                violationType = `TOUCHE ${e.key} INTERDITE`;
            }
            
            // WIN + quelque chose
            else if (e.metaKey) {
                violationType = `WIN+${e.key?.toUpperCase() || 'TOUCHE'} INTERDIT`;
            }
            
            // TOUCHES MYST√âRIEUSES (sans nom mais avec code suspect)
            else if (!e.key || e.key === 'Unidentified' || e.key === '') {
                if (e.keyCode > 40 && e.keyCode < 200) {
                    violationType = `TOUCHE MYST√âRIEUSE INTERDITE (Code: ${e.keyCode})`;
                    addLog(`üîç TOUCHE MYST√âRIEUSE: Code ${e.keyCode} sans nom`);
                }
            }
            
            // Si violation d√©tect√©e
            if (violationType) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                showOverlay(violationType);
                return false;
            }
            
        }, true);

        // Protection clic-droit
        document.addEventListener('contextmenu', function(e) {
            const isInInput = e.target.matches('input, textarea');
            if (!isInInput) {
                e.preventDefault();
                showOverlay('CLIC-DROIT INTERDIT');
                addLog('üö® Clic-droit bloqu√©');
                return false;
            }
        });

        // Protection s√©lection
        document.addEventListener('selectstart', function(e) {
            const isInInput = e.target.matches('input, textarea');
            if (!isInInput) {
                e.preventDefault();
                addLog('üö® S√©lection bloqu√©e');
                return false;
            }
        });

        // D√âTECTION MOBILE - COMPORTEMENTS SUSPECTS
        let mobileActivity = {
            tabSwitches: 0,
            quickReturns: 0,
            suspiciousGestures: 0,
            orientationChanges: 0
        };

        // D√©tection appareil mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        if (isMobile) {
            addLog('üì± APPAREIL MOBILE D√âTECT√â - Surveillance comportementale activ√©e');

            // 1. SURVEILLANCE CHANGEMENTS D'ONGLET
            let lastVisibilityChange = 0;
            document.addEventListener('visibilitychange', function() {
                const now = Date.now();
                
                if (document.hidden) {
                    mobileActivity.tabSwitches++;
                    lastVisibilityChange = now;
                    addLog(`üì± Sortie d'onglet (${mobileActivity.tabSwitches}e fois)`);
                    
                    // Si trop de sorties = suspect
                    if (mobileActivity.tabSwitches >= 3) {
                        showOverlay('ACTIVIT√â MOBILE SUSPECTE - MULTIPLES SORTIES D\'ONGLET');
                    }
                } else {
                    const timeDiff = now - lastVisibilityChange;
                    if (timeDiff < 3000 && mobileActivity.tabSwitches >= 2) {
                        mobileActivity.quickReturns++;
                        addLog(`üì± Retour rapide suspect (${timeDiff}ms)`);
                        showOverlay('PATTERN MOBILE SUSPECT - RETOUR RAPIDE D√âTECT√â');
                    }
                }
            });

            // 2. D√âTECTION GESTES MULTI-TOUCH
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length >= 3) {
                    mobileActivity.suspiciousGestures++;
                    addLog(`üì± Geste multi-touch suspect (${e.touches.length} doigts)`);
                    showOverlay('GESTE MOBILE INTERDIT - CAPTURE SUSPECT√âE');
                    e.preventDefault();
                }
            });

            // 3. SURVEILLANCE ORIENTATION (souvent = screenshot)
            window.addEventListener('orientationchange', function() {
                mobileActivity.orientationChanges++;
                addLog(`üì± Changement orientation (${mobileActivity.orientationChanges}e fois)`);
                showOverlay('CHANGEMENT ORIENTATION - CAPTURE SUSPECT√âE');
            });

            // 4. D√âTECTION VIBRATION (certains mobiles vibrent lors de screenshots)
            if ('vibrate' in navigator) {
                // On peut pas d√©tecter la vibration, mais on peut en cr√©er une pour dissuader
                setInterval(() => {
                    if (mobileActivity.tabSwitches >= 2) {
                        navigator.vibrate([200, 100, 200]); // Vibration dissuasive
                    }
                }, 30000);
            }

            // 5. SURVEILLANCE PAGE FOCUS (perte/retour rapide)
            let focusLossCount = 0;
            window.addEventListener('blur', function() {
                focusLossCount++;
                if (focusLossCount >= 3) {
                    showOverlay('PERTE DE FOCUS R√âP√âT√âE - ACTIVIT√â SUSPECTE');
                }
            });

            // 6. ALERTE PR√âVENTIVE MOBILE
            setTimeout(() => {
                showOverlay('MODE MOBILE - SURVEILLANCE ACTIVE<br>TOUTE CAPTURE SERA D√âTECT√âE');
            }, 5000);
        }
        window.addEventListener('load', function() {
            addLog('üõ°Ô∏è Syst√®me PIVAR initialis√© - Version simplifi√©e');
            addLog('Testez les touches pour voir les overlays');
            
            // Test automatique apr√®s 3 secondes
            setTimeout(() => {
                addLog('‚è≥ Test automatique de l\'overlay dans 2 secondes...');
                setTimeout(() => {
                    showOverlay('D√âMONSTRATION AUTOMATIQUE');
                }, 2000);
            }, 3000);
        });
    </script>
</body>
</html>
